<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éˆæ„Ÿä¸æ˜¯äººé€ çš„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f4e8d0 0%, #e6d3b0 50%, #d4c19c 100%);
            min-height: 100vh;
            color: #4a3728;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, rgba(139, 117, 93, 0.1) 1px, transparent 1px),
                linear-gradient(-45deg, rgba(139, 117, 93, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 20% 80%, rgba(139, 117, 93, 0.05) 2px, transparent 2px),
                radial-gradient(circle at 80% 20%, rgba(139, 117, 93, 0.05) 2px, transparent 2px);
            background-size: 60px 60px, 60px 60px, 120px 120px, 120px 120px;
            z-index: -1;
            pointer-events: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é–‹å ´é é¢æ¨£å¼ */
        .intro-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .intro-content {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(139, 117, 93, 0.2);
            border: 2px solid rgba(139, 117, 93, 0.3);
            position: relative;
        }

        .intro-content::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(139, 117, 93, 0.2);
            border-radius: 10px;
            pointer-events: none;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #8b755d;
            text-shadow: 2px 2px 4px rgba(139, 117, 93, 0.3);
            letter-spacing: 2px;
        }

        .story-content {
            text-align: left;
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #5a4a3a;
        }

        .start-btn {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: none;
            padding: 20px 40px;
            border-radius: 8px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(139, 117, 93, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(139, 117, 93, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-header {
            font-size: 2.2em;
            color: #8b755d;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .timer {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
        }

        .timer h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #5a4a3a;
        }

        .time-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #8b755d;
            text-shadow: 1px 1px 2px rgba(139, 117, 93, 0.3);
        }

        /* é—œå¡é¸æ“‡ç¶²æ ¼ */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .level-card {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(139, 117, 93, 0.15);
            border-radius: 8px;
            pointer-events: none;
        }

        .level-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .level-card.completed {
            background: rgba(166, 137, 104, 0.3);
            border-color: rgba(139, 117, 93, 0.5);
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #8b755d;
        }

        .level-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            border: 1px solid;
        }

        .status-available {
            background: rgba(139, 117, 93, 0.1);
            color: #8b755d;
            border-color: rgba(139, 117, 93, 0.3);
        }

        .status-completed {
            background: rgba(166, 137, 104, 0.2);
            color: #a68968;
            border-color: rgba(166, 137, 104, 0.4);
        }

        .level-description {
            font-size: 0.95em;
            color: #5a4a3a;
            line-height: 1.5;
        }

        /* é—œå¡è©³æƒ…é é¢ */
        .level-detail {
            display: none;
            background: rgba(244, 232, 208, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
            position: relative;
        }

        .level-detail::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(139, 117, 93, 0.15);
            border-radius: 8px;
            pointer-events: none;
        }

        .back-btn {
            background: rgba(139, 117, 93, 0.2);
            color: #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(139, 117, 93, 0.3);
        }

        .story-section {
            background: rgba(139, 117, 93, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1em;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        .story-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #8b755d;
            margin-bottom: 15px;
        }

        .puzzle-content {
            margin-bottom: 20px;
        }

        .puzzle-question {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 15px;
            background: rgba(139, 117, 93, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        /* åœ–ç‰‡ç›¸é—œæ¨£å¼ */
        .puzzle-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(139, 117, 93, 0.3);
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 2px solid rgba(139, 117, 93, 0.2);
        }

        .puzzle-image:hover {
            transform: scale(1.02);
        }

        .puzzle-image.enlarged {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
            border: 5px solid white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 999;
            display: none;
        }

        .question-progress {
            background: rgba(139, 117, 93, 0.1);
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            color: #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(139, 117, 93, 0.3);
            border-radius: 8px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.9);
            color: #4a3728;
            margin-bottom: 15px;
            transition: border-color 0.2s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #8b755d;
            box-shadow: 0 0 0 3px rgba(139, 117, 93, 0.1);
        }

        .submit-btn {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: 1px solid rgba(139, 117, 93, 0.4);
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 
                0 2px 8px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .submit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 4px 12px rgba(139, 117, 93, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .submit-btn:disabled {
            background: rgba(139, 117, 93, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .success-page {
            display: none;
            text-align: center;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
        }

        .success-content {
            background: rgba(244, 232, 208, 0.95);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
        }

        .hidden {
            display: none;
        }

        .error-message {
            background: rgba(184, 92, 71, 0.2);
            color: #8b4513;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid rgba(184, 92, 71, 0.3);
        }

        .success-message {
            background: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid rgba(46, 204, 113, 0.3);
            font-weight: bold;
        }

        .progress-info {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 
                0 2px 8px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .levels-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .level-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2em;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .intro-content,
            .level-detail {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é–‹å ´ä»‹é¢ -->
        <div class="intro-page" id="introPage">
            <div class="intro-content">
                <h1 class="game-title">éˆæ„Ÿä¸æ˜¯äººé€ çš„</h1>
                <div class="story-content">
                    <p><strong>å¤šå…ƒå®‡å®™çš„å¥‡å¹»å†’éšª</strong></p>
                    <br>
                    <p>å‚³èªªä¸­é€™å€‹ä¸–ç•Œæœ‰è¨±å¤šå¹³è¡Œæ™‚ç©ºï¼Œæˆ‘å€‘åˆç¨±å…¶å¤šå…ƒå®‡å®™ã€‚é€™å€‹æ•…äº‹åœ¨èªªçš„æ˜¯ä¸€ä½åŒå¾·åœ‹å°çš„å°æœ‹å‹<strong>é«˜å°æ˜</strong>ï¼Œåœ¨ä¸åŒçš„å®‡å®™ä¸­ï¼Œæœ‰è‘—ä¸åŒçš„å€‹æ€§ï¼Œå»éƒ½åœ¨å­¸æ ¡é‡ä¸Šäº†æ€ªäº‹ã€‚</p>
                    <br>
                    <p>æ“šèªªåªæœ‰ä¸åŒå®‡å®™çš„é«˜å°æ˜åˆ†åˆ¥æ‰¾åˆ°ç™¼ç”Ÿé€™äº›æ€ªäº‹çš„åŸå› ï¼Œé«˜å°æ˜æ‰èƒ½ä¸å†é‡åˆ°æ€ªäº‹ã€‚</p>
                    <br>
                    <p><strong>ä½ çš„ä»»å‹™ï¼š</strong>æ¢ç´¢å…­å€‹å¹³è¡Œå®‡å®™ï¼Œå¹«åŠ©ä¸åŒçš„é«˜å°æ˜è§£é–‹è¬åœ˜ï¼</p>
                    <br>
                    <p><strong>æ™‚é–“é™åˆ¶ï¼š40åˆ†é˜</strong></p>
                </div>
                <button class="start-btn" onclick="startGame()">é–‹å§‹å†’éšª</button>
            </div>
        </div>

        <!-- éŠæˆ²ä¸»é é¢ -->
        <div id="gameContainer" class="hidden">
            <div class="header">
                <h1 class="game-header">å¤šå…ƒå®‡å®™æ¢ç´¢</h1>
            </div>

            <!-- è¨ˆæ™‚å™¨ -->
            <div class="timer">
                <h2>å‰©é¤˜æ™‚é–“</h2>
                <div class="time-display" id="timeDisplay">40:00</div>
            </div>

            <!-- é€²åº¦é¡¯ç¤º -->
            <div class="progress-info">
                <span id="progressText">å·²å®Œæˆ 0/6 å€‹å®‡å®™</span>
            </div>

            <!-- é—œå¡é¸æ“‡é é¢ -->
            <div id="levelsGrid" class="levels-grid">
                <div class="level-card" onclick="openLevel(1)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™ä¸€ - æ¶ˆå¤±çš„ç­†</div>
                        <div class="level-status status-available" id="status1">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        å¥½å‹•æ„›èªªè©±ï¼Œå……æ»¿å¥½å¥‡å¿ƒçš„é«˜å°æ˜ï¼Œå› ç‚ºæ‹¿è§’è½è£¡çš„ä¸€æç­†å¯«å­—è€Œæ¶ˆå¤±äº†...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(2)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™äºŒ - æ›‰æŸ”çš„å°é›</div>
                        <div class="level-status status-available" id="status2">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        é«˜ç˜¦é»é»‘ç†±æƒ…ï¼Œå–œæ„›å‹•ç‰©çš„é«˜å°æ˜ï¼Œåœ¨æ—©è‡ªç¿’æ‰“æƒæ™‚çœ‹åˆ°äº†å¹¾éš»ç¥ç§˜çš„å°é›...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(3)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™ä¸‰ - æ·±å¤œçš„é›é³´è²</div>
                        <div class="level-status status-available" id="status3">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        çŸ®çŸ®èƒ–èƒ–ï¼Œè‡‰ä¸Šæœ‰äº•å­—å‹å‚·ç–¤çš„é«˜å°æ˜ï¼Œä¸€ç›´æœ‰å€‹æƒ³è¦é•·é«˜çš„é¡˜æœ›...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(4)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™å›› - å·¨å¤§å¤–æ˜Ÿé›</div>
                        <div class="level-status status-available" id="status4">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        ä¸ç›¸ä¿¡å¤–æ˜Ÿäººï¼Œæ•´å¤©èª¿çš®æ—è›‹æ„›æ•´äººçš„é«˜å°æ˜ï¼Œé‡åˆ°äº†çœŸæ­£çš„å¤–æ˜Ÿç”Ÿç‰©...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(5)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™äº” - é¾œä»™äººçš„è©›å’’</div>
                        <div class="level-status status-available" id="status5">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        å¾ˆå€’æ¥£çš„è†½å°é¬¼é«˜å°æ˜ï¼Œæ“šèªªè¢«é¾œä»™äººè©›å’’äº†ï¼Œæ²å…¥äº†ä¸€å ´ç¥ç§˜å¯¦é©—...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(6)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™å…­ - ç¥ç§˜ç¬¬å…­é—œ</div>
                        <div class="level-status status-available" id="status6">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        ç¬¬å…­å€‹å®‡å®™çš„é«˜å°æ˜é‡åˆ°äº†ä»€éº¼æ¨£çš„æ€ªäº‹å‘¢ï¼Ÿè«‹åœ¨é€™è£¡å¡«å…¥ç¬¬å…­é—œçš„ç°¡ä»‹...
                    </div>
                </div>
            </div>

            <!-- é—œå¡è©³æƒ…é é¢ -->
            <div class="level-detail" id="levelDetail">
                <button class="back-btn" onclick="backToGrid()">â† è¿”å›å®‡å®™é¸æ“‡</button>
                <div id="levelContent"></div>
            </div>
        </div>

        <!-- æˆåŠŸé é¢ -->
        <div class="success-page" id="successPage">
            <div class="success-content">
                <h1>æ­å–œéé—œï¼</h1>
                <h2>å¤šå…ƒå®‡å®™çš„é«˜å°æ˜å€‘éƒ½å¾—æ•‘äº†ï¼</h2>
                <p>ä½ æˆåŠŸè§£é–‹äº†æ‰€æœ‰è¬åœ˜ï¼Œæ‹¯æ•‘äº†å…­å€‹å®‡å®™çš„é«˜å°æ˜ï¼</p>
                <div id="finalTime"></div>
                <div style="margin-top: 30px; padding: 20px; background: rgba(139, 117, 93, 0.1); border-radius: 10px; border: 1px solid rgba(139, 117, 93, 0.2);">
                    <p>ğŸ‰ æ­å–œä½ å®Œæˆäº†é€™è¶Ÿå¤šå…ƒå®‡å®™çš„å¥‡å¹»å†’éšªï¼</p>
                    <p>âœ¨ æ‰€æœ‰å®‡å®™çš„é«˜å°æ˜éƒ½å› ç‚ºä½ çš„å¹«åŠ©è€Œå¾—æ•‘äº†ï¼</p>
                    <p>ğŸŒŸ ä½ å±•ç¾äº†å“è¶Šçš„è§£è¬èƒ½åŠ›å’Œå …æŒä¸æ‡ˆçš„ç²¾ç¥ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ–ç‰‡æ”¾å¤§è¦†è“‹å±¤ -->
    <div class="overlay" id="overlay" onclick="closeEnlargedImage()"></div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let timeLeft = 40 * 60; // 40åˆ†é˜ï¼ˆç§’ï¼‰
        let gameTimer;
        let completedLevels = new Set();
        let currentLevel2Question = 0; // å®‡å®™äºŒçš„ç•¶å‰å•é¡Œ

        // æ¯é—œçš„æ­£ç¢ºç­”æ¡ˆ
        const answers = {
            1: "ç­”æ¡ˆ1", // è«‹ä¿®æ”¹ç‚ºç¬¬ä¸€é—œçš„æ­£ç¢ºç­”æ¡ˆ
            2: ["2786", "HN84", "é‡é€¢"], // å®‡å®™äºŒçš„ä¸‰å€‹ç­”æ¡ˆ
            3: "ç­”æ¡ˆ3", // è«‹ä¿®æ”¹ç‚ºç¬¬ä¸‰é—œçš„æ­£ç¢ºç­”æ¡ˆ
            4: "ç­”æ¡ˆ4", // è«‹ä¿®æ”¹ç‚ºç¬¬å››é—œçš„æ­£ç¢ºç­”æ¡ˆ
            5: "ç­”æ¡ˆ5", // è«‹ä¿®æ”¹ç‚ºç¬¬äº”é—œçš„æ­£ç¢ºç­”æ¡ˆ
            6: "ç­”æ¡ˆ6"  // è«‹ä¿®æ”¹ç‚ºç¬¬å…­é—œçš„æ­£ç¢ºç­”æ¡ˆ
        };

        // å®‡å®™äºŒçš„åœ–ç‰‡è¬é¡Œ
        const universe2Questions = [
            {
                text: "è§€å¯Ÿåœ–ç‰‡ä¸­çš„ç·šç´¢ï¼Œæ‰¾å‡ºéš±è—çš„æ•¸å­—å¯†ç¢¼",
                image: "ans01_001.png",
                answer: "2786"
            },
            {
                text: "ä»”ç´°ç ”ç©¶åœ–ç‰‡ï¼Œç ´è§£å…¶ä¸­çš„å­—æ¯æ•¸å­—çµ„åˆ", 
                image: "ans01_002.png",
                answer: "HN84"
            },
            {
                text: "çœ‹æ‡‚åœ–ç‰‡æƒ³è¦è¡¨é”çš„å«ç¾©æ˜¯ä»€éº¼ï¼Ÿ",
                image: "ans01_003.png", 
                answer: "é‡é€¢"
            }
        ];

        // é—œå¡å…§å®¹
        const levelContents = {
            1: {
                title: "å®‡å®™ä¸€ - æ¶ˆå¤±çš„ç­†",
                story: `åœ¨ç¬¬ä¸€å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯ä¸€å€‹å¥½å‹•æ„›èªªè©±ï¼Œå……æ»¿å¥½å¥‡å¿ƒçš„å­¸ç”Ÿã€‚å› ç‚ºæ‹¿è§’è½è£¡çš„ä¸€æç­†å¯«å­—è€Œæ¶ˆå¤±äº†ï¼Œä»–çš„æœ‹å‹è¡¨ç¤ºï¼šã€Œæˆ‘çš„æœ‹å‹é«˜å°æ˜ä¸è¦‹äº†ï¼ã€

æ•…äº‹çš„èµ·æºæ˜¯é«˜å°æ˜ååœ¨æ•™å®¤çš„è§’è½ï¼Œä»–åœ¨å¯«å­—æ™‚çªç„¶çœ‹åˆ°ä¸€æç­†æ–¼æ˜¯æ’¿äº†èµ·ä¾†ï¼Œä¹‹å¾Œå°±æ²’äººçœ‹åˆ°ä»–ã€‚æ–¼æ˜¯æœ‰äººçœ‹åˆ°äº†ä¸€å¼µç´™æ¢ï¼ä¸Šé¢å¯«è‘—ã€Œä¾†ï½æ•‘ï½æˆ‘ï½ã€ï¼

éš”å¤©ï¼Œè­¦å¯Ÿä¾†äº†ä¹Ÿä¸€ç„¡æ‰€ç©«ï¼Œå¤§å®¶éƒ½å¾ˆå®³æ€•ï½ éäº†å¹¾å¤©ã€Œåˆæœ‰äººä¸è¦‹äº†ã€ï¼`,
                question: "è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬ä¸€é—œçš„è¬é¡Œå…§å®¹..."
            },
            2: {
                title: "å®‡å®™äºŒ - æ›‰æŸ”çš„å°é›",
                story: `ç¬¬äºŒå€‹å¤šå…ƒå®‡å®™çš„é«˜å°æ˜é«˜ç˜¦é»é»‘ç†±æƒ…ï¼Œæ˜¯ä¸€ä½å–œæ„›å‹•ç‰©çš„å­¸ç”Ÿã€‚

å­¸æ ¡å¾å‰æ˜¯ä¸€åº§ç‰§å ´ï¼Œç‰§å ´çš„é™¢é•·çš„å°å­©æ›‰æŸ”åœ¨ç¾åœ¨çš„è³‡å„ªç­è£¡é¤Šäº†å››éš»é›ï¼Œåˆ†åˆ¥å«åšå°ç±³ã€å˜Ÿå˜Ÿã€åœ“åœ“ã€é»ƒé»ƒã€‚å¥¹æ¯å¤©éƒ½ç´°å¿ƒç…§é¡§å°é›ï¼Œåƒåœ¨ç…§é¡§è‡ªå·±çš„å°å­©ä¸€æ¨£ã€‚

æŸå¤©ï¼Œç‰§å ´çªç„¶å‚³ä¾†æ¶ˆæ¯ï¼Œé™„è¿‘è¾²å ´çˆ†ç™¼ç¦½æµæ„Ÿã€‚é™¢é•·ç«‹åˆ»åŠ å¼·æ¶ˆæ¯’ï¼Œä½†æ‚²åŠ‡é‚„æ˜¯æ‚„æ‚„é™è‡¨äº†ã€‚å…ˆæ˜¯å°ç±³å‚é ­å–ªæ°£ã€åœæ­¢é€²é£Ÿï¼Œæ¥è‘—å…¶ä»–ä¸‰éš»ä¹Ÿé™¸çºŒå‡ºç¾ç—‡ç‹€ã€‚æ›‰æŸ”å› å‚·å¿ƒéåº¦è€Œèº«äº¡ã€‚

å¹¾å¹´å¾Œï¼Œç‰§å ´è®Šæˆå­¸æ ¡äº†ã€‚æŸå¤©ï¼Œé«˜å°æ˜åœ¨æ—©è‡ªç¿’æ™‚é–“å»æ‰“æƒï¼Œçªç„¶ç™¼ç¾å¹¾éš»å°é›åœ¨è§’è½ï¼Œä»–å¶ç„¶ç™¼ç¾äº†æ›‰æŸ”çš„ç­†è¨˜ã€‚

ç­†è¨˜ä¸­æœ‰ä¸‰å¼µç¥ç§˜çš„åœ–ç‰‡ï¼Œä¼¼ä¹éš±è—è‘—é‡è¦çš„ç·šç´¢...`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            3: {
                title: "å®‡å®™ä¸‰ - æ·±å¤œçš„é›é³´è²",
                story: `é«˜å°æ˜åœ¨ç¬¬ä¸‰å€‹å¤šå…ƒå®‡å®™ä¸­çŸ®çŸ®èƒ–èƒ–çš„ï¼Œè‡‰ä¸Šé‚„æœ‰ä¸€å€‹äº•å­—å‹çš„å‚·ç–¤ï¼Œä¸€ç›´æœ‰å€‹æƒ³è¦é•·é«˜çš„é¡˜æœ›ã€‚

é€™æ˜¯ä¸€å€‹æ ¡åœ’å‚³èªªï¼šã€Šæ·±å¤œçš„é›é³´è²ã€‹
åªè¦åœ¨ä¹é»åŠè½åˆ°æ ¡åœ’è£¡å‚³ä¾†é›çš„å«è²ï¼Œå°±ä»£è¡¨æœ‰å­¸ç”Ÿçš„é¡˜æœ›å³å°‡å¯¦ç¾ã€‚

é€™å€‹å‚³èªªå§‹æ–¼åå¤šå¹´å‰çš„ç”·å­©å°æ©ï¼Œä»–é«”å¼±å¤šç—…ï¼Œæœ€å¤§çš„å¤¢æƒ³å°±æ˜¯å’ŒåŒå­¸å€‘ä¸€èµ·åœ¨æ“å ´ä¸Šå¥”è·‘ã€‚æŸå¤©é‹å‹•æœƒå‰å¤•ï¼Œå°æ©ä½é™¢äº†ã€‚ç•¶æ™šï¼Œè­¦è¡›çªç„¶è½è¦‹æ“å ´å‚³ä¾†æ¸…æ™°çš„ã€Œå–”å–”å–”â€”â€”ã€é›å«è²ã€‚

ç¬¬äºŒå¤©æ—©ä¸Šï¼Œå°æ©å¥‡è¹Ÿä¼¼åœ°åº·å¾©äº†ã€‚ç¾åœ¨å­¸ç”Ÿå€‘éƒ½èªªï¼šã€Œæ¯ç•¶ä¹é»åŠçš„é›é³´éŸ¿èµ·ï¼Œå¸Œæœ›ä¹‹ç¥ä¾†äº†ï¼Œä»–æœƒå¹«ä½ å¯¦ç¾é‚£å€‹æœ€æ·±æœ€ç´”ç²¹çš„é¡˜æœ›ã€‚ã€`,
                question: "è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬ä¸‰é—œçš„è¬é¡Œå…§å®¹..."
            },
            4: {
                title: "å®‡å®™å›› - å·¨å¤§å¤–æ˜Ÿé›",
                story: `ç¬¬å››å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯ä¸€å€‹ä¸ç›¸ä¿¡å¤–æ˜Ÿäººï¼Œæ•´å¤©èª¿çš®æ—è›‹æ„›æ•´äººçš„å­¸ç”Ÿã€‚

ä½†æœ‰ä¸€å¤©å‡ºç¾äº†ä¸€éš»å·¨å¤§çš„å¤–æ˜Ÿé›ï¼é˜¿é›ä¾†åˆ°äººé¡çš„ä¸–ç•Œï¼Œç‰ çœ‹åˆ°çš„ç¬¬ä¸€å€‹äººé¡æ˜¯é«˜å°æ˜ã€‚

å› ç‚ºç‰ éå¸¸çš„ã€Œé›ã€é¤“ï¼Œæ‰€ä»¥å°±æŠŠé«˜å°æ˜ä¸€å£åƒæ‰äº†ï¼ï¼åœ¨é«˜å°æ˜è¢«åƒæ‰çš„å‰10ç§’ï¼Œä»–ä¸€ç›´åœ¨ä¸å°ˆå¿ƒçš„æ»‘æ‰‹æ©Ÿã€‚å¾Œä¾†å°±è¢«é©šåš‡çš„æ¯›éƒ½é£›èµ·ä¾†äº†...`,
                question: "è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬å››é—œçš„è¬é¡Œå…§å®¹..."
            },
            5: {
                title: "å®‡å®™äº” - é¾œä»™äººçš„è©›å’’",
                story: `ç¬¬äº”å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯å€‹å¾ˆå€’æ¥£çš„è†½å°é¬¼ï¼Œæ“šèªªä»–æ˜¯è¢«é¾œä»™äººè©›å’’äº†ã€‚

é¾œä»™äººçœ‹åˆ°äº†åŠ‰å°åŠ›çš„æ¯›æ•£è½åœ¨åœ°ï¼Œå°±æ’¿èµ·ä¸€æ ¹æ¯›ï¼Œæ‹¿å»åšå¯¦é©—ã€‚åˆ°äº†å¯¦é©—å®¤ï¼Œç§‘å­¸å®¶è·Ÿç¥‚èªªï¼šã€Œé€™å€‹æ¯›å¾ˆçè²´ï¼Œèª°è½ä¸‹äº†é€™æ ¹æ¯›ï¼Ÿã€

é¾œä»™äººèªªï¼šã€Œé€™æ˜¯åŠ‰å°åŠ›æ‰çš„...ã€ç§‘å­¸å®¶èªªï¼šã€Œé‚£æ‰¾å‡ºåŠ‰å°åŠ›ï¼Œä¸€å®šè¦å¿«ï¼ã€

é¾œä»™äººè¦å‡ºé–€äº†ï¼Œç¥‚ä¸€è¸å‡ºé–€å£å°±çœ‹åˆ°äº†åŠ‰å°åŠ›ï¼ŒæŠŠä»–å¸¶åˆ°å¯¦é©—å®¤ã€‚ç§‘å­¸å®¶èªªï¼šã€Œå…ˆæŠŠä»–æ‰“æšˆï¼Œå†å–å¹¾æ ¹æ¯›ã€‚ã€

å¾Œä¾†é«˜å°æ˜å°±å‡ºç¾äº†ï¼Œé˜»æ­¢é¾œä»™äººé€™æ¨£åšï¼Œç§‘å­¸å®¶èªªï¼šã€Œç°¡ç›´å°±æ˜¯...å“ˆå“ˆã€ã€‚`,
                question: "è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬äº”é—œçš„è¬é¡Œå…§å®¹..."
            },
            6: {
                title: "å®‡å®™å…­ - ç¥ç§˜ç¬¬å…­é—œ",
                story: `è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬å…­é—œçš„å®Œæ•´æ•…äº‹èƒŒæ™¯...

é€™æ˜¯ç¬¬å…­å€‹å®‡å®™çš„é«˜å°æ˜é‡åˆ°çš„ç¥ç§˜äº‹ä»¶ï¼Œè«‹æè¿°ä»–çš„æ€§æ ¼ç‰¹å¾µå’Œé‡åˆ°çš„æ€ªäº‹ã€‚`,
                question: "è«‹åœ¨é€™è£¡å¡«å…¥ç¬¬å…­é—œçš„è¬é¡Œå…§å®¹..."
            }
        };

        // é–‹å§‹éŠæˆ²
        function startGame() {
            document.getElementById('introPage').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            startTimer();
            updateProgress();
        }

        // é–‹å§‹éŠæˆ²è¨ˆæ™‚å™¨
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimeDisplay();
                
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTimeDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeDisplay').textContent = timeString;
            
            // æ™‚é–“ä¸è¶³æ™‚è®Šç´…è‰²
            if (timeLeft <= 300) { // 5åˆ†é˜
                document.getElementById('timeDisplay').style.color = '#b85c47';
            }
        }

        // æ‰“é–‹é—œå¡
        function openLevel(level) {
            const content = levelContents[level];
            document.getElementById('levelsGrid').classList.add('hidden');
            document.getElementById('levelDetail').style.display = 'block';
            
            if (level === 2) {
                // å®‡å®™äºŒçš„ç‰¹æ®Šè™•ç† - åœ–ç‰‡è¬é¡Œ
                currentLevel2Question = 0;
                showUniverse2Content();
            } else {
                // å…¶ä»–é—œå¡çš„ä¸€èˆ¬è™•ç†
                document.getElementById('levelContent').innerHTML = `
                    <div class="level-header">
                        <div class="level-title">${content.title}</div>
                        <div class="level-status ${completedLevels.has(level) ? 'status-completed' : 'status-available'}">
                            ${completedLevels.has(level) ? 'å·²å®Œæˆ' : 'æ¢ç´¢ä¸­'}
                        </div>
                    </div>
                    <div class="story-section">
                        <div class="story-title">æ•…äº‹èƒŒæ™¯</div>
                        <p style="white-space: pre-line;">${content.story}</p>
                    </div>
                    <div class="puzzle-content">
                        <div class="puzzle-question">
                            <strong>è¬é¡Œï¼š</strong>${content.question}
                        </div>
                        <input type="text" class="answer-input" id="answer${level}" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ" ${completedLevels.has(level) ? 'disabled' : ''}>
                        <button class="submit-btn" onclick="checkAnswer(${level})" ${completedLevels.has(level) ? 'disabled' : ''}>
                            ${completedLevels.has(level) ? 'å·²å®Œæˆ' : 'æäº¤ç­”æ¡ˆ'}
                        </button>
                        <div class="error-message" id="error${level}"></div>
                        <div class="success-message" id="success${level}"></div>
                    </div>
                `;
            }
        }

        // é¡¯ç¤ºå®‡å®™äºŒçš„å…§å®¹ï¼ˆåœ–ç‰‡è¬é¡Œï¼‰
        function showUniverse2Content() {
            const content = levelContents[2];
            const currentQ = universe2Questions[currentLevel2Question];
            const isCompleted = completedLevels.has(2);
            
            document.getElementById('levelContent').innerHTML = `
                <div class="level-header">
                    <div class="level-title">${content.title}</div>
                    <div class="level-status ${isCompleted ? 'status-completed' : 'status-available'}">
                        ${isCompleted ? 'å·²å®Œæˆ' : 'æ¢ç´¢ä¸­'}
                    </div>
                </div>
                <div class="story-section">
                    <div class="story-title">æ•…äº‹èƒŒæ™¯</div>
                    <p style="white-space: pre-line;">${content.story}</p>
                </div>
                <div class="puzzle-content">
                    ${!isCompleted ? `
                        <div class="question-progress">
                            ç¬¬ ${currentLevel2Question + 1} é¡Œ / å…± 3 é¡Œ
                        </div>
                        <div class="puzzle-question">
                            <strong>è¬é¡Œï¼š</strong>${currentQ.text}
                        </div>
                        <img src="${currentQ.image}" class="puzzle-image" onclick="enlargeImage()" alt="è¬é¡Œåœ–ç‰‡">
                        <input type="text" class="answer-input" id="answer2" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ" onkeypress="handleEnter(event, 2)">
                        <button class="submit-btn" onclick="checkUniverse2Answer()">æäº¤ç­”æ¡ˆ</button>
                        <div class="error-message" id="error2"></div>
                        <div class="success-message" id="success2"></div>
                    ` : `
                        <div class="puzzle-question">
                            <strong>âœ… å®‡å®™äºŒå·²å®Œæˆï¼</strong><br>
                            ä½ æˆåŠŸè§£é–‹äº†æ›‰æŸ”ç­†è¨˜ä¸­çš„æ‰€æœ‰è¬é¡Œï¼
                        </div>
                    `}
                </div>
            `;
        }

        // æª¢æŸ¥å®‡å®™äºŒçš„ç­”æ¡ˆ
        function checkUniverse2Answer() {
            const userAnswer = document.getElementById('answer2').value.trim();
            const correctAnswer = universe2Questions[currentLevel2Question].answer;
            const errorDiv = document.getElementById('error2');
            const successDiv = document.getElementById('success2');
            
            if (userAnswer === '') {
                errorDiv.textContent = 'è«‹è¼¸å…¥ç­”æ¡ˆï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            if (userAnswer === correctAnswer) {
                // ç­”æ¡ˆæ­£ç¢º
                successDiv.textContent = 'ç­”å°äº†ï¼';
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                
                setTimeout(() => {
                    currentLevel2Question++;
                    if (currentLevel2Question >= universe2Questions.length) {
                        // å®Œæˆå®‡å®™äºŒ
                        completeLevel(2);
                        showUniverse2Content();
                    } else {
                        // é€²å…¥ä¸‹ä¸€é¡Œ
                        showUniverse2Content();
                    }
                }, 1500);
            } else {
                // ç­”æ¡ˆéŒ¯èª¤
                errorDiv.textContent = 'ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // åœ–ç‰‡æ”¾å¤§åŠŸèƒ½
        function enlargeImage() {
            const image = document.querySelector('.puzzle-image');
            const overlay = document.getElementById('overlay');
            
            if (image) {
                image.classList.add('enlarged');
                overlay.style.display = 'block';
            }
        }

        // é—œé–‰æ”¾å¤§çš„åœ–ç‰‡
        function closeEnlargedImage() {
            const image = document.querySelector('.puzzle-image');
            const overlay = document.getElementById('overlay');
            
            if (image) {
                image.classList.remove('enlarged');
                overlay.style.display = 'none';
            }
        }

        // è™•ç†Enteréµæäº¤
        function handleEnter(event, level) {
            if (event.key === 'Enter') {
                if (level === 2) {
                    checkUniverse2Answer();
                } else {
                    checkAnswer(level);
                }
            }
        }

        // è¿”å›é—œå¡é¸æ“‡
        function backToGrid() {
            document.getElementById('levelDetail').style.display = 'none';
            document.getElementById('levelsGrid').classList.remove('hidden');
            // é‡ç½®å®‡å®™äºŒçš„é€²åº¦ï¼ˆå¦‚æœæ²’å®Œæˆçš„è©±ï¼‰
            if (!completedLevels.has(2)) {
                currentLevel2Question = 0;
            }
        }

        // æª¢æŸ¥ç­”æ¡ˆï¼ˆä¸€èˆ¬é—œå¡ï¼‰
        function checkAnswer(level) {
            if (completedLevels.has(level) || level === 2) return;
            
            const userAnswer = document.getElementById(`answer${level}`).value.trim();
            const correctAnswer = answers[level];
            const errorDiv = document.getElementById(`error${level}`);
            const successDiv = document.getElementById(`success${level}`);
            
            if (userAnswer === '') {
                errorDiv.textContent = 'è«‹è¼¸å…¥ç­”æ¡ˆï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                // ç­”æ¡ˆæ­£ç¢º
                successDiv.textContent = 'ç­”å°äº†ï¼é—œå¡å®Œæˆï¼';
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                
                setTimeout(() => {
                    completeLevel(level);
                }, 1500);
            } else {
                // ç­”æ¡ˆéŒ¯èª¤
                errorDiv.textContent = 'ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // å®Œæˆé—œå¡
        function completeLevel(level) {
            completedLevels.add(level);
            
            // æ›´æ–°é—œå¡ç‹€æ…‹
            const statusElement = document.querySelector(`#status${level}`);
            statusElement.textContent = 'å·²å®Œæˆ';
            statusElement.className = 'level-status status-completed';
            
            // æ›´æ–°é—œå¡å¡ç‰‡æ¨£å¼
            const cardElement = statusElement.closest('.level-card');
            cardElement.classList.add('completed');
            
            // æ›´æ–°é€²åº¦
            updateProgress();
            
            // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
            if (completedLevels.size === 6) {
                setTimeout(() => {
                    endGame(true);
                }, 1000);
            }
        }

        // æ›´æ–°é€²åº¦é¡¯ç¤º
        function updateProgress() {
            document.getElementById('progressText').textContent = `å·²å®Œæˆ ${completedLevels.size}/6 å€‹å®‡å®™`;
        }

        // çµæŸéŠæˆ²
        function endGame(success) {
            clearInterval(gameTimer);
            
            if (success) {
                // è¨ˆç®—å®Œæˆæ™‚é–“
                const totalTime = 40 * 60 - timeLeft;
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                const timeString = `${minutes}åˆ†${seconds}ç§’`;
                
                document.getElementById('finalTime').innerHTML = `<h3>å®Œæˆæ™‚é–“: ${timeString}</h3>`;
                document.getElementById('gameContainer').style.display = 'none';
                document.getElementById('successPage').style.display = 'flex';
            } else {
                alert('æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸã€‚è«‹é‡æ–°é–‹å§‹ã€‚');
                location.reload();
            }
        }

        // æŒ‰Enteréµæäº¤ç­”æ¡ˆï¼ˆä¸€èˆ¬ç‰ˆæœ¬ï¼‰
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.classList.contains('answer-input')) {
                    const level = parseInt(activeElement.id.replace('answer', ''));
                    if (level === 2) {
                        checkUniverse2Answer();
                    } else {
                        checkAnswer(level);
                    }
                }
            }
        });
    </script>
</body>
</html>
