<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éˆæ„Ÿä¸æ˜¯äººçµ¦çš„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f4e8d0 0%, #e6d3b0 50%, #d4c19c 100%);
            min-height: 100vh;
            color: #4a3728;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, rgba(139, 117, 93, 0.1) 1px, transparent 1px),
                linear-gradient(-45deg, rgba(139, 117, 93, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 20% 80%, rgba(139, 117, 93, 0.05) 2px, transparent 2px),
                radial-gradient(circle at 80% 20%, rgba(139, 117, 93, 0.05) 2px, transparent 2px);
            background-size: 60px 60px, 60px 60px, 120px 120px, 120px 120px;
            z-index: -1;
            pointer-events: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* éš±è—é¡åˆ¥ */
        .hidden {
            display: none !important;
        }

        /* é–‹å ´é é¢æ¨£å¼ */
        .intro-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .intro-content {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(139, 117, 93, 0.2);
            border: 2px solid rgba(139, 117, 93, 0.3);
            position: relative;
        }

        .intro-content::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(139, 117, 93, 0.2);
            border-radius: 10px;
            pointer-events: none;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #8b755d;
            text-shadow: 2px 2px 4px rgba(139, 117, 93, 0.3);
            letter-spacing: 2px;
        }

        .story-content {
            text-align: left;
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #5a4a3a;
        }

        .start-btn {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: none;
            padding: 20px 40px;
            border-radius: 8px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(139, 117, 93, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(139, 117, 93, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-header {
            font-size: 2.2em;
            color: #8b755d;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .timer {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
        }

        .timer h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #5a4a3a;
        }

        .time-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #8b755d;
            text-shadow: 1px 1px 2px rgba(139, 117, 93, 0.3);
        }

        /* é—œå¡é¸æ“‡ç¶²æ ¼ */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .level-card {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 
                0 4px 15px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(139, 117, 93, 0.15);
            border-radius: 8px;
            pointer-events: none;
        }

        .level-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .level-card.completed {
            background: rgba(166, 137, 104, 0.3);
            border-color: rgba(139, 117, 93, 0.5);
        }

        .level-card.locked {
            background: rgba(139, 117, 93, 0.1);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .level-card.locked:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(139, 117, 93, 0.2);
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #8b755d;
        }

        .level-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            border: 1px solid;
        }

        .status-available {
            background: rgba(139, 117, 93, 0.1);
            color: #8b755d;
            border-color: rgba(139, 117, 93, 0.3);
        }

        .status-completed {
            background: rgba(166, 137, 104, 0.2);
            color: #a68968;
            border-color: rgba(166, 137, 104, 0.4);
        }

        .status-locked {
            background: rgba(184, 92, 71, 0.1);
            color: #8b4513;
            border-color: rgba(184, 92, 71, 0.3);
        }

        .level-description {
            font-size: 0.95em;
            color: #5a4a3a;
            line-height: 1.5;
        }

        /* é—œå¡è©³æƒ…é é¢ */
        .level-detail {
            display: none;
            background: rgba(244, 232, 208, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
            position: relative;
        }

        .level-detail::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid rgba(139, 117, 93, 0.15);
            border-radius: 8px;
            pointer-events: none;
        }

        .back-btn {
            background: rgba(139, 117, 93, 0.2);
            color: #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            margin-right: 10px;
            font-size: 0.9em;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .back-btn:hover {
            background: rgba(139, 117, 93, 0.3);
        }

        .reset-btn {
            background: rgba(184, 92, 71, 0.2);
            color: #8b4513;
            border: 1px solid rgba(184, 92, 71, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 0.9em;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .reset-btn:hover {
            background: rgba(184, 92, 71, 0.3);
        }

        .story-section {
            background: rgba(139, 117, 93, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1em;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        .story-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #8b755d;
            margin-bottom: 15px;
        }

        .puzzle-content {
            margin-bottom: 20px;
        }

        .puzzle-question {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 15px;
            background: rgba(139, 117, 93, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        /* åœ–ç‰‡ç›¸é—œæ¨£å¼ */
        .puzzle-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(139, 117, 93, 0.3);
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 2px solid rgba(139, 117, 93, 0.2);
        }

        .puzzle-image:hover {
            transform: scale(1.02);
        }

        .puzzle-image.enlarged {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
            border: 5px solid white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 999;
            display: none;
        }

        .question-progress {
            background: rgba(139, 117, 93, 0.1);
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            color: #8b755d;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(139, 117, 93, 0.3);
            border-radius: 8px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.9);
            color: #4a3728;
            margin-bottom: 15px;
            transition: border-color 0.2s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #8b755d;
            box-shadow: 0 0 0 3px rgba(139, 117, 93, 0.1);
        }

        .submit-btn {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: 1px solid rgba(139, 117, 93, 0.4);
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 
                0 2px 8px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .submit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 4px 12px rgba(139, 117, 93, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .submit-btn:disabled {
            background: rgba(139, 117, 93, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        /* æˆåŠŸé é¢ - å®Œå…¨éš±è—åœ¨åˆå§‹ç‹€æ…‹ */
        .success-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #f4e8d0 0%, #e6d3b0 50%, #d4c19c 100%);
            z-index: 9999;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .success-content {
            background: rgba(244, 232, 208, 0.95);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(139, 117, 93, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }

        .error-message {
            background: rgba(184, 92, 71, 0.2);
            color: #8b4513;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid rgba(184, 92, 71, 0.3);
        }

        .success-message {
            background: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid rgba(46, 204, 113, 0.3);
            font-weight: bold;
        }

        .progress-info {
            background: rgba(244, 232, 208, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 
                0 2px 8px rgba(139, 117, 93, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 117, 93, 0.3);
        }

        /* å­—æ¯æ”¶é›†é¡¯ç¤º */
        .collected-letters {
            background: rgba(139, 117, 93, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(139, 117, 93, 0.2);
        }

        .collected-letters h3 {
            color: #8b755d;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .letter-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .letter-item {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: 2px solid rgba(139, 117, 93, 0.4);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(139, 117, 93, 0.3);
        }

        /* å­—æ¯æ‰è½å½ˆå‡ºè¦–çª— */
        .letter-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .letter-popup-content {
            background: rgba(244, 232, 208, 0.95);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(139, 117, 93, 0.3);
            border: 2px solid rgba(139, 117, 93, 0.3);
            max-width: 400px;
            animation: letterDrop 0.5s ease-out;
        }

        @keyframes letterDrop {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .letter-popup h2 {
            color: #8b755d;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .letter-popup .letter-item {
            font-size: 2em;
            padding: 20px 30px;
            margin: 20px auto;
            display: inline-block;
        }

        /* ç¬¬å…­é—œè§£é–ç•Œé¢ */
        .unlock-interface {
            background: rgba(139, 117, 93, 0.1);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(139, 117, 93, 0.3);
            text-align: center;
        }

        .unlock-interface h3 {
            color: #8b755d;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .unlock-hint {
            color: #5a4a3a;
            margin-bottom: 20px;
            font-style: italic;
        }

        .letter-input-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .letter-input {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(139, 117, 93, 0.3);
            border-radius: 8px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.9);
            color: #4a3728;
            text-transform: uppercase;
        }

        .letter-input:focus {
            outline: none;
            border-color: #8b755d;
            box-shadow: 0 0 0 3px rgba(139, 117, 93, 0.1);
        }

        /* ç¬¬å…­é—œæ‹¼å­—éŠæˆ²æ¨£å¼ */
        .letter-tile {
            background: linear-gradient(135deg, #8b755d 0%, #a68968 100%);
            color: #f4e8d0;
            border: 2px solid rgba(139, 117, 93, 0.4);
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(139, 117, 93, 0.3);
            min-width: 50px;
            text-align: center;
        }

        .letter-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 117, 93, 0.4);
        }

        .letter-tile.placed {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-color: rgba(46, 204, 113, 0.4);
        }

        .answer-slot {
            min-width: 60px;
            min-height: 60px;
            border: 2px dashed #8b755d;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(139, 117, 93, 0.05);
            transition: all 0.3s ease;
        }

        .answer-slot.filled {
            border-style: solid;
            background: rgba(139, 117, 93, 0.1);
        }

        .answer-slot:hover {
            background: rgba(139, 117, 93, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .levels-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .level-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2em;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .intro-content,
            .level-detail {
                padding: 25px;
            }

            .letter-input-area {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é–‹å ´ä»‹é¢ -->
        <div class="intro-page" id="introPage">
            <div class="intro-content">
                <h1 class="game-title">éˆæ„Ÿä¸æ˜¯äººçµ¦çš„</h1>
                <div class="story-content">
                    <p><strong>å¤šå…ƒå®‡å®™çš„å¥‡å¹»å†’éšª</strong></p>
                    <br>
                    <p>å‚³èªªä¸­é€™å€‹ä¸–ç•Œæœ‰è¨±å¤šå¹³è¡Œæ™‚ç©ºï¼Œæˆ‘å€‘åˆç¨±å…¶å¤šå…ƒå®‡å®™ã€‚é€™å€‹æ•…äº‹åœ¨èªªçš„æ˜¯ä¸€ä½åŒå¾·åœ‹å°çš„å°æœ‹å‹<strong>é«˜å°æ˜</strong>ï¼Œåœ¨ä¸åŒçš„å®‡å®™ä¸­ï¼Œæœ‰è‘—ä¸åŒçš„å€‹æ€§ï¼Œå»éƒ½åœ¨å­¸æ ¡é‡ä¸Šäº†æ€ªäº‹ã€‚</p>
                    <br>
                    <p>æ“šèªªåªæœ‰ä¸åŒå®‡å®™çš„é«˜å°æ˜åˆ†åˆ¥æ‰¾åˆ°ç™¼ç”Ÿé€™äº›æ€ªäº‹çš„åŸå› ï¼Œé«˜å°æ˜æ‰èƒ½ä¸å†é‡åˆ°æ€ªäº‹ã€‚</p>
                    <br>
                    <p><strong>ä½ çš„ä»»å‹™ï¼š</strong>æ¢ç´¢å…­å€‹å¹³è¡Œå®‡å®™ï¼Œå¹«åŠ©ä¸åŒçš„é«˜å°æ˜è§£é–‹è¬åœ˜ï¼</p>
                    <br>
                    <p><strong>æ™‚é–“é™åˆ¶ï¼š40åˆ†é˜</strong></p>
                    <div id="progressInfo" style="font-size: 0.9em; color: #8b755d; margin-top: 15px; font-style: italic; text-align: center;">
                        <!-- é€²åº¦è³‡è¨Šæœƒåœ¨é€™è£¡å‹•æ…‹é¡¯ç¤º -->
                    </div>
                </div>
                <button class="start-btn" onclick="startGame()">é–‹å§‹å†’éšª</button>
            </div>
        </div>

        <!-- éŠæˆ²ä¸»é é¢ -->
        <div id="gameContainer" class="hidden">
            <div class="header">
                <h1 class="game-header">æ‹¯æ•‘å¤šå…ƒå®‡å®™çš„é«˜å°æ˜</h1>
            </div>

            <!-- è¨ˆæ™‚å™¨ -->
            <div class="timer">
                <h2>å‰©é¤˜æ™‚é–“</h2>
                <div class="time-display" id="timeDisplay">40:00</div>
            </div>

            <!-- é€²åº¦é¡¯ç¤º -->
            <div class="progress-info">
                <span id="progressText">å·²å®Œæˆ 0/6 å€‹å®‡å®™</span>
            </div>

            <!-- æ”¶é›†çš„å­—æ¯é¡¯ç¤º -->
            <div class="collected-letters" id="collectedLetters" style="display: none;">
                <h3>æ”¶é›†çš„ç¥ç§˜å­—æ¯</h3>
                <div class="letter-display" id="letterDisplay">
                    <!-- å­—æ¯æœƒåœ¨é€™è£¡å‹•æ…‹é¡¯ç¤º -->
                </div>
            </div>

            <!-- é—œå¡é¸æ“‡é é¢ -->
            <div id="levelsGrid" class="levels-grid">
                <div class="level-card" onclick="openLevel(1)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™ä¸€ - æ¶ˆå¤±çš„ç­†</div>
                        <div class="level-status status-available" id="status1">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        å¥½å‹•æ„›èªªè©±ï¼Œå……æ»¿å¥½å¥‡å¿ƒçš„é«˜å°æ˜ï¼Œå› ç‚ºæ‹¿è§’è½è£¡çš„ä¸€æç­†å¯«å­—è€Œæ¶ˆå¤±äº†...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(2)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™äºŒ - æ›‰æŸ”çš„å°é›</div>
                        <div class="level-status status-available" id="status2">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        é«˜ç˜¦é»é»‘ç†±æƒ…ï¼Œå–œæ„›å‹•ç‰©çš„é«˜å°æ˜ï¼Œåœ¨æ—©è‡ªç¿’æ‰“æƒæ™‚çœ‹åˆ°äº†å¹¾éš»ç¥ç§˜çš„å°é›...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(3)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™ä¸‰ - æ·±å¤œçš„é›é³´è²</div>
                        <div class="level-status status-available" id="status3">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        çŸ®çŸ®èƒ–èƒ–ï¼Œè‡‰ä¸Šæœ‰äº•å­—å‹å‚·ç–¤çš„é«˜å°æ˜ï¼Œä¸€ç›´æœ‰å€‹æƒ³è¦é•·é«˜çš„é¡˜æœ›...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(4)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™å›› - å·¨å¤§å¤–æ˜Ÿé›</div>
                        <div class="level-status status-available" id="status4">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        ä¸ç›¸ä¿¡å¤–æ˜Ÿäººï¼Œæ•´å¤©èª¿çš®æ—è›‹æ„›æ•´äººçš„é«˜å°æ˜ï¼Œé‡åˆ°äº†çœŸæ­£çš„å¤–æ˜Ÿç”Ÿç‰©...
                    </div>
                </div>

                <div class="level-card" onclick="openLevel(5)">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™äº” - é¾œä»™äººçš„è©›å’’</div>
                        <div class="level-status status-available" id="status5">å¯æ¢ç´¢</div>
                    </div>
                    <div class="level-description">
                        å¾ˆå€’æ¥£çš„è†½å°é¬¼é«˜å°æ˜ï¼Œæ“šèªªè¢«é¾œä»™äººè©›å’’äº†ï¼Œæ²å…¥äº†ä¸€å ´ç¥ç§˜å¯¦é©—...
                    </div>
                </div>

                <div class="level-card locked" id="level6Card">
                    <div class="level-header">
                        <div class="level-title">å®‡å®™å…­ - å‰µé€ è€…çš„æŒ‘æˆ°</div>
                        <div class="level-status status-locked" id="status6">éœ€è¦è§£é–</div>
                    </div>
                    <div class="level-description">
                        å……æ»¿å‰µæ„å’Œæƒ³åƒåŠ›çš„é«˜å°æ˜ï¼Œåœ¨ç¥ç§˜æ©Ÿå™¨å‰æ¥å—å‰µé€ è€…çš„æœ€çµ‚è©¦ç…‰...<br>
                        <span style="color: #8b4513; font-weight: bold; font-style: italic;">éœ€è¦æ”¶é›†æ‰€æœ‰ç¥ç§˜å­—æ¯æ‰èƒ½è§£é–</span>
                    </div>
                </div>
            </div>

            <!-- é—œå¡è©³æƒ…é é¢ -->
            <div class="level-detail" id="levelDetail">
                <button class="back-btn" onclick="backToGrid()">è¿”å›å®‡å®™é¸æ“‡</button>
                <div id="levelContent"></div>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸé é¢ - å®Œå…¨ç¨ç«‹æ–¼ä¸»å®¹å™¨ -->
    <div class="success-page" id="successPage">
        <div class="success-content">
            <h1 style="color: #8b755d; font-size: 2.5em; margin-bottom: 20px;">ğŸ‰ æ­å–œéé—œï¼ ğŸ‰</h1>
            <h2 style="color: #a68968; font-size: 1.8em; margin-bottom: 30px;">æ­¡è¿åŠ å…¥åŒå¾·åœ‹å°å‰µé€ åŠ›è³‡å„ªç­ï¼</h2>
            <div id="finalTime" style="font-size: 1.3em; color: #5a4a3a; margin-bottom: 30px; font-weight: bold;"></div>
            <div style="margin-top: 30px; padding: 25px; background: rgba(139, 117, 93, 0.1); border-radius: 15px; border: 2px solid rgba(139, 117, 93, 0.2);">
                <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>ä½ æˆåŠŸè§£é–‹äº†æ‰€æœ‰è¬åœ˜ï¼Œæ‹¯æ•‘äº†å…­å€‹å®‡å®™çš„é«˜å°æ˜ï¼</strong></p>
                <p style="font-size: 1.2em; color: #8b755d; font-weight: bold;">æ­¡è¿åŠ å…¥å‰µé€ åŠ›è³‡å„ªç­é€™å€‹å¤§å®¶åº­ï¼</p>
            </div>
            <button class="start-btn" onclick="resetGame()" style="margin-top: 30px; font-size: 1.2em; padding: 15px 40px;">é‡æ–°é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <!-- å­—æ¯æ‰è½å½ˆå‡ºè¦–çª— -->
    <div class="letter-popup" id="letterPopup">
        <div class="letter-popup-content">
            <h2>æ­å–œä½ æ’¿åˆ°å­—æ¯</h2>
            <div class="letter-item" id="droppedLetter">?</div>
            <p id="letterMessage">ä½ ç²å¾—äº†ä¸€å€‹ç¥ç§˜å­—æ¯ï¼</p>
            <button class="start-btn" onclick="closeLetterPopup()" style="margin-top: 20px;">ç¹¼çºŒå†’éšª</button>
        </div>
    </div>

    <!-- åœ–ç‰‡æ”¾å¤§è¦†è“‹å±¤ -->
    <div class="overlay" id="overlay" onclick="closeEnlargedImage()"></div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let timeLeft = 40 * 60;
        let gameTimer;
        let completedLevels = new Set();
        let currentLevel1Question = 0;
        let currentLevel2Question = 0;
        let currentLevel3Question = 0;
        let currentLevel4Question = 0;
        let currentLevel5Question = 0;
        let gameStarted = false;
        let collectedLetters = new Set(); // æ”¶é›†çš„å­—æ¯

        // å­—æ¯æ‰è½æ˜ å°„
        const levelLetters = {
            1: 'C', // æ¶ˆå¤±çš„ç­†
            2: 'A', // æ›‰æŸ”çš„å°é›
            3: 'T', // æ·±å¤œçš„é›é³´è²
            4: 'E', // å·¨å¤§å¤–æ˜Ÿé›
            5: 'R'  // é¾œä»™äººçš„è©›å’’
        };

        // é€²åº¦ä¿å­˜å’Œæ¢å¾©
        function saveProgress() {
            const progress = {
                completedLevels: Array.from(completedLevels),
                collectedLetters: Array.from(collectedLetters),
                currentLevel1Question: currentLevel1Question,
                currentLevel2Question: currentLevel2Question,
                currentLevel3Question: currentLevel3Question,
                currentLevel4Question: currentLevel4Question,
                currentLevel5Question: currentLevel5Question,
                timeLeft: timeLeft
            };
            window.gameProgress = progress;
        }

        function loadProgress() {
            if (window.gameProgress) {
                const progress = window.gameProgress;
                completedLevels = new Set(progress.completedLevels);
                collectedLetters = new Set(progress.collectedLetters || []);
                currentLevel1Question = progress.currentLevel1Question || 0;
                currentLevel2Question = progress.currentLevel2Question || 0;
                currentLevel3Question = progress.currentLevel3Question || 0;
                currentLevel4Question = progress.currentLevel4Question || 0;
                currentLevel5Question = progress.currentLevel5Question || 0;
                timeLeft = progress.timeLeft || 40 * 60;
                return true;
            }
            return false;
        }

        // ç­”æ¡ˆå®šç¾©
        const answers = {
            1: ["é ‚æ¨“", "å¸å¡µå™¨", "C"],
            2: ["2786", "H4N9", "é‡é€¢"],
            3: ["25213", "é»ƒè‰²", "ç›¸ä¿¡"],
            4: ["è—", "UP", "2227"],
            5: ["æ™®é€šé¾œ", "é’æ±Ÿèœ", "R"],
            6: "CREATE"
        };

        // é¡Œç›®å®šç¾©
        const universe1Questions = [
            { text: "é«˜å°æ˜å¤±è¹¤å‰æœ€å¾Œå‡ºç¾çš„åœ°é»åœ¨å“ªè£¡ï¼Ÿ", image: "ans05_001.png", answer: "é ‚æ¨“" },
            { text: "æ‰¾å‡ºèƒ½å¤ å¹«åŠ©å°‹æ‰¾é«˜å°æ˜çš„é‡è¦å·¥å…·", image: "ans05_002.png", answer: "å¸å¡µå™¨" },
            { text: "ç ´è§£æ•‘æ´è¨ˆç•«çš„æœ€çµ‚å¯†ç¢¼", image: "ans05_003.png", answer: "C" }
        ];

        const universe2Questions = [
            { text: "è§€å¯Ÿåœ–ç‰‡ä¸­çš„ç·šç´¢ï¼Œæ‰¾å‡ºéš±è—çš„æ•¸å­—å¯†ç¢¼", image: "ans01_001.png", answer: "2786" },
            { text: "ä»”ç´°ç ”ç©¶åœ–ç‰‡ï¼Œç ´è§£å…¶ä¸­çš„å­—æ¯æ•¸å­—çµ„åˆ", image: "ans01_002.png", answer: "H4N9" },
            { text: "çœ‹æ‡‚åœ–ç‰‡æƒ³è¦è¡¨é”çš„å«ç¾©æ˜¯ä»€éº¼ï¼Ÿ", image: "ans01_003.png", answer: "é‡é€¢" }
        ];

        const universe3Questions = [
            { text: "çªç„¶å‡ºç¾äº”éš»å°é›ï¼æ’æˆä¸€æ’ä¼¼ä¹åœ¨æç¤ºä»€éº¼ï¼Ÿ", image: "ans_02_001.png", answer: "25213" },
            { text: "è§€å¯Ÿåœ–ç‰‡ä¸­ç·¨è™Ÿæ‰€å°æ‡‰çš„å°é›ï¼Œç‰ çš„é ­æ˜¯ä»€éº¼é¡è‰²ï¼Ÿé¡è‰²ä¼¼ä¹å°±æ˜¯ç·šç´¢ï¼", image: "ans_02_002.png", answer: "é»ƒè‰²" },
            { text: "è¦å¯¦ç¾é¡˜æœ›çš„ç§˜è¨£æ˜¯ä»€éº¼ï¼Ÿ", image: "ans_02_003.png", answer: "ç›¸ä¿¡" }
        ];

        const universe4Questions = [
            { text: "å¤–æ˜Ÿé›å‘Šè¨´é«˜å°æ˜ä¸€å€‹é‡è¦çš„é¡è‰²ç·šç´¢ï¼Œæ˜¯ä»€éº¼é¡è‰²ï¼Ÿ", image: "ans03_001.png", answer: "è—" },
            { text: "å¤–æ˜Ÿé›æŒ‡å‘å¤©ç©ºï¼Œç‰ æƒ³èªªä»€éº¼æ–¹å‘ï¼Ÿ", image: "ans03_002.png", answer: "UP" },
            { text: "ç ´è§£å¤–æ˜Ÿé›ç•™ä¸‹çš„ç¥ç§˜æ•¸å­—å¯†ç¢¼", image: "ans03_003.png", answer: "2227" }
        ];

        const universe5Questions = [
            { text: "é¾œä»™äººçš„çœŸå¯¦èº«ä»½æ˜¯ä»€éº¼ï¼Ÿä»”ç´°è§€å¯Ÿåœ–ç‰‡ä¸­çš„ç·šç´¢", image: "ans04_001.png", answer: "æ™®é€šé¾œ" },
            { text: "é¾œä»™äººé‚„æ²’æ‰¾åˆ°çš„æ±è¥¿æ˜¯ä»€éº¼ï¼Ÿ", image: "ans04_002.png", answer: "é’æ±Ÿèœ" },
            { text: "ç ´è§£æœ€çµ‚çš„å­—æ¯å¯†ç¢¼ï¼Œæ‹¯æ•‘é«˜å°æ˜ï¼", image: "ans04_003.png", answer: "R" }
        ];

        // é—œå¡å…§å®¹
        const levelContents = {
            1: {
                title: "å®‡å®™ä¸€ - æ¶ˆå¤±çš„ç­†",
                story: `åœ¨ç¬¬ä¸€å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯ä¸€å€‹å¥½å‹•æ„›èªªè©±ï¼Œå……æ»¿å¥½å¥‡å¿ƒçš„å­¸ç”Ÿã€‚å› ç‚ºæ‹¿è§’è½è£¡çš„ä¸€æç­†å¯«å­—è€Œæ¶ˆå¤±äº†ï¼Œä»–çš„æœ‹å‹è¡¨ç¤ºï¼šã€Œæˆ‘çš„æœ‹å‹é«˜å°æ˜ä¸è¦‹äº†ï¼ã€

æ•…äº‹çš„èµ·æºæ˜¯é«˜å°æ˜ååœ¨æ•™å®¤çš„è§’è½ï¼Œä»–åœ¨å¯«å­—æ™‚çªç„¶çœ‹åˆ°ä¸€æç­†æ–¼æ˜¯æ’¿äº†èµ·ä¾†ï¼Œä¹‹å¾Œå°±æ²’äººçœ‹åˆ°ä»–ã€‚æ–¼æ˜¯æœ‰äººçœ‹åˆ°äº†ä¸€å¼µç´™æ¢ï¼ä¸Šé¢å¯«è‘—ã€Œä¾†ï½æ•‘ï½æˆ‘ï½ã€ï¼

éš”å¤©ï¼Œè­¦å¯Ÿä¾†äº†ä¹Ÿä¸€ç„¡æ‰€ç©«ï¼Œå¤§å®¶éƒ½å¾ˆå®³æ€•ï½ éäº†å¹¾å¤©ã€Œåˆæœ‰äººä¸è¦‹äº†ã€ï¼

ç‚ºäº†æ‹¯æ•‘é«˜å°æ˜å’Œå…¶ä»–å¤±è¹¤çš„åŒå­¸ï¼Œä½ å¿…é ˆè§£é–‹ä¸‰å€‹é‡è¦çš„è¬é¡Œ...`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            2: {
                title: "å®‡å®™äºŒ - æ›‰æŸ”çš„å°é›",
                story: `ç¬¬äºŒå€‹å¤šå…ƒå®‡å®™çš„é«˜å°æ˜é«˜ç˜¦é»é»‘ç†±æƒ…ï¼Œæ˜¯ä¸€ä½å–œæ„›å‹•ç‰©çš„å­¸ç”Ÿã€‚

å­¸æ ¡å¾å‰æ˜¯ä¸€åº§ç‰§å ´ï¼Œç‰§å ´çš„é™¢é•·çš„å°å­©æ›‰æŸ”åœ¨ç¾åœ¨çš„è³‡å„ªç­è£¡é¤Šäº†å››éš»é›ï¼Œåˆ†åˆ¥å«åšå°ç±³ã€å˜Ÿå˜Ÿã€åœ“åœ“ã€é»ƒé»ƒã€‚å¥¹æ¯å¤©éƒ½ç´°å¿ƒç…§é¡§å°é›ï¼Œåƒåœ¨ç…§é¡§è‡ªå·±çš„å°å­©ä¸€æ¨£ã€‚

æŸå¤©ï¼Œç‰§å ´çªç„¶å‚³ä¾†æ¶ˆæ¯ï¼Œé™„è¿‘è¾²å ´çˆ†ç™¼ç¦½æµæ„Ÿã€‚é™¢é•·ç«‹åˆ»åŠ å¼·æ¶ˆæ¯’ï¼Œä½†æ‚²åŠ‡é‚„æ˜¯æ‚„æ‚„é™è‡¨äº†ã€‚å…ˆæ˜¯å°ç±³å‚é ­å–ªæ°£ã€åœæ­¢é€²é£Ÿï¼Œæ¥è‘—å…¶ä»–ä¸‰éš»ä¹Ÿé™¸çºŒå‡ºç¾ç—‡ç‹€ã€‚æ›‰æŸ”å› å‚·å¿ƒéåº¦è€Œèº«äº¡ã€‚

å¹¾å¹´å¾Œï¼Œç‰§å ´è®Šæˆå­¸æ ¡äº†ã€‚æŸå¤©ï¼Œé«˜å°æ˜åœ¨æ—©è‡ªç¿’æ™‚é–“å»æ‰“æƒï¼Œçªç„¶ç™¼ç¾å¹¾éš»å°é›åœ¨è§’è½ï¼Œä»–å¶ç„¶ç™¼ç¾äº†æ›‰æŸ”çš„ç­†è¨˜ã€‚

ç­†è¨˜ä¸­æœ‰ä¸‰å¼µç¥ç§˜çš„åœ–ç‰‡ï¼Œä¼¼ä¹éš±è—è‘—é‡è¦çš„ç·šç´¢...`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            3: {
                title: "å®‡å®™ä¸‰ - æ·±å¤œçš„é›é³´è²",
                story: `é«˜å°æ˜åœ¨ç¬¬ä¸‰å€‹å¤šå…ƒå®‡å®™ä¸­çŸ®çŸ®èƒ–èƒ–çš„ï¼Œè‡‰ä¸Šé‚„æœ‰ä¸€å€‹äº•å­—å‹çš„å‚·ç–¤ï¼Œä¸€ç›´æœ‰å€‹æƒ³è¦é•·é«˜çš„é¡˜æœ›ã€‚

é€™æ˜¯ä¸€å€‹æ ¡åœ’å‚³èªªï¼šã€Šæ·±å¤œçš„é›é³´è²ã€‹
åªè¦åœ¨ä¹é»åŠè½åˆ°æ ¡åœ’è£¡å‚³ä¾†é›çš„å«è²ï¼Œå°±ä»£è¡¨æœ‰å­¸ç”Ÿçš„é¡˜æœ›å³å°‡å¯¦ç¾ã€‚

é€™å€‹å‚³èªªå§‹æ–¼åå¤šå¹´å‰çš„ç”·å­©å°æ©ï¼Œä»–é«”å¼±å¤šç—…ï¼Œæœ€å¤§çš„å¤¢æƒ³å°±æ˜¯å’ŒåŒå­¸å€‘ä¸€èµ·åœ¨æ“å ´ä¸Šå¥”è·‘ã€‚æŸå¤©é‹å‹•æœƒå‰å¤•ï¼Œå°æ©ä½é™¢äº†ã€‚ç•¶æ™šï¼Œè­¦è¡›çªç„¶è½è¦‹æ“å ´å‚³ä¾†æ¸…æ™°çš„ã€Œå–”å–”å–”â€”â€”ã€é›å«è²ã€‚

ç¬¬äºŒå¤©æ—©ä¸Šï¼Œå°æ©å¥‡è¹Ÿä¼¼åœ°åº·å¾©äº†ã€‚ç¾åœ¨å­¸ç”Ÿå€‘éƒ½èªªï¼šã€Œæ¯ç•¶ä¹é»åŠçš„é›é³´éŸ¿èµ·ï¼Œå¸Œæœ›ä¹‹ç¥ä¾†äº†ï¼Œä»–æœƒå¹«ä½ å¯¦ç¾é‚£å€‹æœ€æ·±æœ€ç´”ç²¹çš„é¡˜æœ›ã€‚ã€

é«˜å°æ˜ä¹Ÿè½èªªäº†é€™å€‹å‚³èªªï¼Œä»–æ±ºå®šè¦åœ¨ä¹é»åŠå»æ ¡åœ’è£¡ç­‰å¾…ï¼Œå¸Œæœ›èƒ½å¯¦ç¾é•·é«˜çš„é¡˜æœ›ã€‚ä½†æ˜¯ï¼Œä»–é‡åˆ°äº†ä¸€äº›ç¥ç§˜çš„ç·šç´¢...`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            4: {
                title: "å®‡å®™å›› - å·¨å¤§å¤–æ˜Ÿé›",
                story: `ç¬¬å››å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯ä¸€å€‹ä¸ç›¸ä¿¡å¤–æ˜Ÿäººï¼Œæ•´å¤©èª¿çš®æ—è›‹æ„›æ•´äººçš„å­¸ç”Ÿã€‚

ä½†æœ‰ä¸€å¤©å‡ºç¾äº†ä¸€éš»å·¨å¤§çš„å¤–æ˜Ÿé›ï¼é˜¿é›ä¾†åˆ°äººé¡çš„ä¸–ç•Œï¼Œç‰ çœ‹åˆ°çš„ç¬¬ä¸€å€‹äººé¡æ˜¯é«˜å°æ˜ã€‚

å› ç‚ºç‰ éå¸¸çš„ã€Œé›ã€é¤“ï¼Œæ‰€ä»¥å°±æŠŠé«˜å°æ˜ä¸€å£åƒæ‰äº†ï¼ï¼åœ¨é«˜å°æ˜è¢«åƒæ‰çš„å‰10ç§’ï¼Œä»–ä¸€ç›´åœ¨ä¸å°ˆå¿ƒçš„æ»‘æ‰‹æ©Ÿã€‚å¾Œä¾†å°±è¢«é©šåš‡çš„æ¯›éƒ½é£›èµ·ä¾†äº†...

ä½†æ˜¯å¤–æ˜Ÿé›å…¶å¯¦æ˜¯å–„è‰¯çš„ï¼Œç‰ æƒ³è¦å¹«åŠ©é«˜å°æ˜é€ƒé›¢é€™å€‹å›°å¢ƒã€‚å¤–æ˜Ÿé›ç•™ä¸‹äº†ä¸‰å€‹é‡è¦çš„ç·šç´¢ï¼Œåªæœ‰è§£é–‹é€™äº›è¬é¡Œï¼Œé«˜å°æ˜æ‰èƒ½é‡ç²è‡ªç”±ï¼`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            5: {
                title: "å®‡å®™äº” - é¾œä»™äººçš„è©›å’’",
                story: `ç¬¬äº”å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯å€‹å¾ˆå€’æ¥£çš„è†½å°é¬¼ï¼Œæ“šèªªä»–æ˜¯è¢«é¾œä»™äººè©›å’’äº†ã€‚

é¾œä»™äººçœ‹åˆ°äº†åŠ‰å°åŠ›çš„æ¯›æ•£è½åœ¨åœ°ï¼Œå°±æ’¿èµ·ä¸€æ ¹æ¯›ï¼Œæ‹¿å»åšå¯¦é©—ã€‚åˆ°äº†å¯¦é©—å®¤ï¼Œç§‘å­¸å®¶è·Ÿç¥‚èªªï¼šã€Œé€™å€‹æ¯›å¾ˆçè²´ï¼Œèª°è½ä¸‹äº†é€™æ ¹æ¯›ï¼Ÿã€

é¾œä»™äººèªªï¼šã€Œé€™æ˜¯åŠ‰å°åŠ›æ‰çš„...ã€ç§‘å­¸å®¶èªªï¼šã€Œé‚£æ‰¾å‡ºåŠ‰å°åŠ›ï¼Œä¸€å®šè¦å¿«ï¼ã€

é¾œä»™äººè¦å‡ºé–€äº†ï¼Œç¥‚ä¸€è¸å‡ºé–€å£å°±çœ‹åˆ°äº†åŠ‰å°åŠ›ï¼ŒæŠŠä»–å¸¶åˆ°å¯¦é©—å®¤ã€‚ç§‘å­¸å®¶èªªï¼šã€Œå…ˆæŠŠä»–æ‰“æšˆï¼Œå†å–å¹¾æ ¹æ¯›ã€‚ã€

å¾Œä¾†é«˜å°æ˜å°±å‡ºç¾äº†ï¼Œé˜»æ­¢é¾œä»™äººé€™æ¨£åšï¼Œç§‘å­¸å®¶èªªï¼šã€Œç°¡ç›´å°±æ˜¯...å“ˆå“ˆã€ã€‚

ç‚ºäº†æ‹¯æ•‘åŠ‰å°åŠ›å’Œè‡ªå·±ï¼Œé«˜å°æ˜å¿…é ˆè§£é–‹é¾œä»™äººç•™ä¸‹çš„ä¸‰å€‹è¬é¡Œ...`,
                question: "åœ–ç‰‡è¬é¡ŒæŒ‘æˆ°"
            },
            6: {
                title: "å®‡å®™å…­ - å‰µé€ è€…çš„æŒ‘æˆ°",
                story: `åœ¨ç¬¬å…­å€‹å¤šå…ƒå®‡å®™ä¸­ï¼Œé«˜å°æ˜æ˜¯ä¸€å€‹å……æ»¿å‰µæ„å’Œæƒ³åƒåŠ›çš„å­¸ç”Ÿï¼Œä»–ç¸½æ˜¯å–œæ­¡å‹•æ‰‹åšæ±è¥¿ï¼Œç™¼æ˜æ–°çš„ç©æ„ã€‚

æœ‰ä¸€å¤©ï¼Œé«˜å°æ˜åœ¨å­¸æ ¡çš„èˆŠå€‰åº«è£¡ç™¼ç¾äº†ä¸€å°ç¥ç§˜çš„å¤è€æ©Ÿå™¨ï¼Œæ©Ÿå™¨ä¸Šåˆ»è‘—å¥‡æ€ªçš„ç¬¦è™Ÿå’Œæ–‡å­—ã€‚ç•¶ä»–ç¢°è§¸æ©Ÿå™¨æ™‚ï¼Œçªç„¶å‡ºç¾äº†ä¸€å€‹å…¨æ¯æŠ•å½±ï¼

æŠ•å½±ä¸­å‡ºç¾äº†ä¸€ä½ç¥ç§˜çš„å‰µé€ è€…ï¼Œä»–èªªï¼šã€Œå¹´è¼•çš„å‰µé€ è€…ï¼Œä½ å·²ç¶“ä¾†åˆ°äº†æœ€å¾Œçš„è©¦ç…‰ã€‚åªæœ‰çœŸæ­£ç†è§£å‰µé€ æœ¬è³ªçš„äººï¼Œæ‰èƒ½è§£é–‹é€™å€‹è¬é¡Œã€‚ã€

ã€Œè¨˜ä½ï¼Œå‰µé€ ä¸æ˜¯æ†‘ç©ºè€Œç”Ÿï¼Œè€Œæ˜¯å°‡å·²æœ‰çš„å…ƒç´ é‡æ–°çµ„åˆï¼Œå½¢æˆå…¨æ–°çš„äº‹ç‰©ã€‚ç¾åœ¨ï¼Œè«‹ç”¨ä½ çš„æ™ºæ…§ï¼Œå°‡æ•£è½çš„å­—æ¯é‡æ–°æ’åˆ—ï¼Œæ‰¾å‡ºå‰µé€ çš„çœŸè«¦ï¼ã€

é€™æ˜¯ä½ åœ¨å¤šå…ƒå®‡å®™ä¸­çš„æœ€å¾ŒæŒ‘æˆ°...`,
                question: "å­—æ¯æ‹¼å­—æŒ‘æˆ°éŠæˆ²"
            }
        };

        // é–‹å§‹éŠæˆ²
        function startGame() {
            loadProgress();
            gameStarted = true;
            document.getElementById('introPage').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            
            // ç¢ºä¿é—œå¡é¸æ“‡é é¢é¡¯ç¤º
            document.getElementById('levelsGrid').classList.remove('hidden');
            document.getElementById('levelDetail').style.display = 'none';
            
            if (completedLevels.size < 6 && !gameTimer) {
                startTimer();
            }
            updateProgress();
            updateCollectedLettersDisplay();
            checkLevel6Unlock();
        }

        // é‡æ–°é–‹å§‹éŠæˆ²
        function resetGame() {
            const confirmReset = confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹éŠæˆ²å—ï¼Ÿé€™å°‡æœƒæ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„é—œå¡é€²åº¦ã€‚');
            
            if (!confirmReset) {
                return;
            }
            
            if (gameTimer) {
                clearInterval(gameTimer);
            }
            
            gameStarted = false;
            timeLeft = 40 * 60;
            completedLevels.clear();
            collectedLetters.clear();
            currentLevel1Question = 0;
            currentLevel2Question = 0;
            currentLevel3Question = 0;
            currentLevel4Question = 0;
            currentLevel5Question = 0;
            
            for (let i = 1; i <= 6; i++) {
                const statusElement = document.querySelector(`#status${i}`);
                if (statusElement) {
                    if (i === 6) {
                        statusElement.textContent = 'éœ€è¦è§£é–';
                        statusElement.className = 'level-status status-locked';
                        document.getElementById('level6Card').classList.add('locked');
                        document.getElementById('level6Card').onclick = null;
                    } else {
                        statusElement.textContent = 'å¯æ¢ç´¢';
                        statusElement.className = 'level-status status-available';
                    }
                    
                    const cardElement = statusElement.closest('.level-card');
                    if (cardElement && i !== 6) {
                        cardElement.classList.remove('completed');
                    }
                }
            }
            
            const progressInfo = document.getElementById('progressInfo');
            if (progressInfo) {
                progressInfo.textContent = '';
            }
            
            document.getElementById('collectedLetters').style.display = 'none';
            
            // éš±è—æˆåŠŸé é¢å’ŒéŠæˆ²å®¹å™¨
            document.getElementById('successPage').style.display = 'none';
            document.getElementById('gameContainer').classList.add('hidden');
            document.getElementById('levelDetail').style.display = 'none';
            document.getElementById('levelsGrid').classList.remove('hidden');
            document.getElementById('introPage').classList.remove('hidden');
            document.getElementById('timeDisplay').style.color = '#8b755d';
        }

        // é¡¯ç¤ºå­—æ¯æ‰è½å½ˆå‡ºè¦–çª—
        function showLetterDrop(letter) {
            document.getElementById('droppedLetter').textContent = letter;
            document.getElementById('letterMessage').textContent = `ä½ ç²å¾—äº†ç¥ç§˜å­—æ¯ã€Œ${letter}ã€ï¼`;
            document.getElementById('letterPopup').style.display = 'flex';
        }

        // é—œé–‰å­—æ¯æ‰è½å½ˆå‡ºè¦–çª—
        function closeLetterPopup() {
            document.getElementById('letterPopup').style.display = 'none';
        }

        // æ›´æ–°æ”¶é›†å­—æ¯é¡¯ç¤º
        function updateCollectedLettersDisplay() {
            const letterDisplay = document.getElementById('letterDisplay');
            const collectedLettersContainer = document.getElementById('collectedLetters');
            
            if (collectedLetters.size > 0) {
                collectedLettersContainer.style.display = 'block';
                letterDisplay.innerHTML = '';
                
                // æŒ‰ç…§ CRATE çš„é †åºé¡¯ç¤º
                const orderLetters = ['C', 'R', 'A', 'T', 'E'];
                orderLetters.forEach(letter => {
                    if (collectedLetters.has(letter)) {
                        const letterItem = document.createElement('div');
                        letterItem.className = 'letter-item';
                        letterItem.textContent = letter;
                        letterDisplay.appendChild(letterItem);
                    }
                });
            } else {
                collectedLettersContainer.style.display = 'none';
            }
        }

        // æª¢æŸ¥ç¬¬å…­é—œè§£é–æ¢ä»¶
        function checkLevel6Unlock() {
            if (collectedLetters.size === 5) {
                const level6Card = document.getElementById('level6Card');
                const status6 = document.getElementById('status6');
                
                level6Card.classList.remove('locked');
                level6Card.onclick = () => openLevel(6);
                status6.textContent = 'å¯è§£é–';
                status6.className = 'level-status status-available';
                
                // æ›´æ–°æè¿°
                level6Card.querySelector('.level-description').innerHTML = `
                    å……æ»¿å‰µæ„å’Œæƒ³åƒåŠ›çš„é«˜å°æ˜ï¼Œåœ¨ç¥ç§˜æ©Ÿå™¨å‰æ¥å—å‰µé€ è€…çš„æœ€çµ‚è©¦ç…‰...<br>
                    <span style="color: #27ae60; font-weight: bold; font-style: italic;">é»æ“Šé€²å…¥è§£é–ç•Œé¢ï¼</span>
                `;
            }
        }

        // æ›´æ–°é¦–é é€²åº¦é¡¯ç¤º
        function updateIntroProgress() {
            const progressInfo = document.getElementById('progressInfo');
            if (completedLevels.size > 0) {
                progressInfo.textContent = `å·²å®Œæˆ ${completedLevels.size}/6 å€‹å®‡å®™ï¼Œç¹¼çºŒä½ çš„å†’éšªï¼`;
            } else {
                progressInfo.textContent = '';
            }
        }

        // è¨ˆæ™‚å™¨
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimeDisplay();
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        function updateTimeDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeDisplay').textContent = timeString;
            
            if (timeLeft <= 300) {
                document.getElementById('timeDisplay').style.color = '#b85c47';
            }
        }

        // æ‰“é–‹é—œå¡
        function openLevel(level) {
            // ç¬¬å…­é—œéœ€è¦ç‰¹æ®Šè™•ç†
            if (level === 6 && collectedLetters.size === 5 && !completedLevels.has(6)) {
                showLevel6UnlockInterface();
                return;
            } else if (level === 6 && collectedLetters.size < 5) {
                alert('éœ€è¦æ”¶é›†æ‰€æœ‰5å€‹ç¥ç§˜å­—æ¯æ‰èƒ½è§£é–ç¬¬å…­é—œï¼');
                return;
            }
            
            loadProgress();
            document.getElementById('levelsGrid').classList.add('hidden');
            document.getElementById('levelDetail').style.display = 'block';
            
            // æª¢æŸ¥é—œå¡æ˜¯å¦å·²å®Œæˆ
            if (completedLevels.has(level)) {
                console.log(`é—œå¡${level}å·²å®Œæˆï¼Œé¡¯ç¤ºå›é¡§æ¨¡å¼`);
            } else {
                console.log(`é—œå¡${level}é€²è¡Œä¸­ï¼Œç•¶å‰é€²åº¦ï¼š`, getCurrentQuestion(level));
            }
            
            if (level === 1) {
                showUniverseContent(1, universe1Questions, 'checkUniverse1Answer');
            } else if (level === 2) {
                showUniverseContent(2, universe2Questions, 'checkUniverse2Answer');
            } else if (level === 3) {
                showUniverseContent(3, universe3Questions, 'checkUniverse3Answer');
            } else if (level === 4) {
                showUniverseContent(4, universe4Questions, 'checkUniverse4Answer');
            } else if (level === 5) {
                showUniverseContent(5, universe5Questions, 'checkUniverse5Answer');
            } else {
                showGeneralLevel(level);
            }
        }

        // é¡¯ç¤ºç¬¬å…­é—œè§£é–ç•Œé¢
        function showLevel6UnlockInterface() {
            document.getElementById('levelsGrid').classList.add('hidden');
            document.getElementById('levelDetail').style.display = 'block';
            
            document.getElementById('levelContent').innerHTML = `
                <div class="level-header">
                    <div class="level-title">å®‡å®™å…­ - å‰µé€ è€…çš„æŒ‘æˆ°</div>
                    <div class="level-status status-available">è§£é–ä¸­</div>
                </div>
                <div class="unlock-interface">
                    <h3>ğŸ” ç¬¬å…­é—œè§£é–æŒ‘æˆ°</h3>
                    <div class="unlock-hint">
                        ä½ å·²ç¶“æ”¶é›†äº†æ‰€æœ‰5å€‹ç¥ç§˜å­—æ¯ï¼<br>
                        ç¾åœ¨è«‹è¼¸å…¥é€™äº”å€‹å­—æ¯ä¾†è§£é–æœ€çµ‚é—œå¡ã€‚<br>
                        <strong>æç¤ºï¼šäº”å€‹æ‰è½çš„å­—æ¯</strong>
                    </div>
                    <div class="letter-input-area">
                        <input type="text" class="letter-input" maxlength="1" id="unlockInput1">
                        <input type="text" class="letter-input" maxlength="1" id="unlockInput2">
                        <input type="text" class="letter-input" maxlength="1" id="unlockInput3">
                        <input type="text" class="letter-input" maxlength="1" id="unlockInput4">
                        <input type="text" class="letter-input" maxlength="1" id="unlockInput5">
                    </div>
                    <button class="submit-btn" onclick="checkUnlockCode()" style="width: auto; padding: 10px 30px;">è§£é–é—œå¡</button>
                    <div class="error-message" id="unlockError"></div>
                </div>
            `;
            
            // æ·»åŠ è¼¸å…¥æ¡†äº‹ä»¶ç›£è½
            for (let i = 1; i <= 5; i++) {
                const input = document.getElementById(`unlockInput${i}`);
                input.addEventListener('input', function() {
                    this.value = this.value.toUpperCase();
                    if (this.value && i < 5) {
                        document.getElementById(`unlockInput${i + 1}`).focus();
                    }
                });
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && i > 1) {
                        document.getElementById(`unlockInput${i - 1}`).focus();
                    }
                });
            }
        }

        // æª¢æŸ¥è§£é–å¯†ç¢¼
        function checkUnlockCode() {
            const inputs = [];
            for (let i = 1; i <= 5; i++) {
                inputs.push(document.getElementById(`unlockInput${i}`).value);
            }
            
            const inputCode = inputs.join('');
            const requiredLetters = ['C', 'R', 'A', 'T', 'E'];
            
            // æª¢æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€çš„å­—æ¯ï¼ˆé †åºä¸é™ï¼‰
            const inputLetters = inputCode.split('');
            const hasAllLetters = requiredLetters.every(letter => inputLetters.includes(letter));
            
            if (inputCode.length !== 5) {
                const errorDiv = document.getElementById('unlockError');
                errorDiv.textContent = 'è«‹è¼¸å…¥å®Œæ•´çš„5å€‹å­—æ¯ï¼';
                errorDiv.style.display = 'block';
                setTimeout(() => errorDiv.style.display = 'none', 3000);
                return;
            }
            
            if (hasAllLetters) {
                // è§£é–æˆåŠŸï¼Œé€²å…¥ç¬¬å…­é—œ
                setTimeout(() => {
                    showGeneralLevel(6);
                }, 1000);
            } else {
                const errorDiv = document.getElementById('unlockError');
                errorDiv.textContent = 'å¯†ç¢¼ä¸æ­£ç¢ºï¼è«‹è¼¸å…¥ä½ æ”¶é›†åˆ°çš„5å€‹ç¥ç§˜å­—æ¯ã€‚';
                errorDiv.style.display = 'block';
                setTimeout(() => errorDiv.style.display = 'none', 3000);
            }
        }

        // é¡¯ç¤ºå®‡å®™å…§å®¹ï¼ˆé€šç”¨å‡½æ•¸ï¼‰
        function showUniverseContent(level, questions, checkFunction) {
            const content = levelContents[level];
            const isCompleted = completedLevels.has(level);
            const currentQuestion = getCurrentQuestion(level);
            
            console.log(`é¡¯ç¤ºå®‡å®™${level}å…§å®¹ - å·²å®Œæˆ: ${isCompleted}, ç•¶å‰é¡Œç›®: ${currentQuestion}, ç¸½é¡Œç›®æ•¸: ${questions.length}`);
            
            let puzzleHTML = '';
            
            // å¦‚æœé—œå¡å·²å®Œæˆï¼Œæˆ–è€…ç•¶å‰é¡Œç›®ç·¨è™Ÿè¶…å‡ºç¯„åœï¼Œé¡¯ç¤ºå›é¡§æ¨¡å¼
            if (isCompleted || currentQuestion >= questions.length) {
                // é¡¯ç¤ºå®Œæˆå¾Œçš„æ‰€æœ‰é¡Œç›®å›é¡§
                puzzleHTML = `
                    <div class="puzzle-question">
                        <strong>å®‡å®™${level}å·²å®Œæˆï¼</strong><br>
                        ä½ æˆåŠŸè§£é–‹äº†æ‰€æœ‰è¬é¡Œï¼é»æ“Šä¸‹æ–¹é¡Œç›®å¯ä»¥æŸ¥çœ‹è©³ç´°å…§å®¹ã€‚
                    </div>
                    <div style="margin-top: 20px;">
                `;
                
                questions.forEach((q, index) => {
                    puzzleHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(139, 117, 93, 0.05); border-radius: 8px; border: 1px solid rgba(139, 117, 93, 0.1); cursor: pointer;" onclick="toggleQuestionDetail(${level}, ${index})">
                            <div style="font-weight: bold; margin-bottom: 10px; color: #8b755d; display: flex; justify-content: space-between; align-items: center;">
                                <span>ç¬¬ ${index + 1} é¡Œï¼š${q.text}</span>
                                <span style="font-size: 0.8em; color: #a68968;" id="toggle${level}_${index}">â–¼ å±•é–‹</span>
                            </div>
                            <div id="detail${level}_${index}" style="display: none;">
                                <img src="${q.image}" class="puzzle-image" onclick="enlargeImage()" alt="è¬é¡Œåœ–ç‰‡" style="margin: 10px 0;">
                                <div style="color: #27ae60; font-weight: bold; padding: 10px; background: rgba(46, 204, 113, 0.1); border-radius: 5px; border: 1px solid rgba(46, 204, 113, 0.2);">ç­”æ¡ˆï¼š${q.answer}</div>
                            </div>
                        </div>
                    `;
                });
                
                puzzleHTML += `
                    </div>
                    <button class="start-btn" onclick="backToGrid()" style="margin-top: 20px; width: 100%;">
                        ç¹¼çºŒæ¢ç´¢å…¶ä»–å¤šå…ƒå®‡å®™
                    </button>
                `;
            } else {
                // é¡¯ç¤ºç•¶å‰é¡Œç›®
                const currentQ = questions[currentQuestion];
                puzzleHTML = `
                    <div class="question-progress">
                        ç¬¬ ${currentQuestion + 1} é¡Œ / å…± ${questions.length} é¡Œ
                    </div>
                    <div class="puzzle-question">
                        <strong>è¬é¡Œï¼š</strong>${currentQ.text}
                    </div>
                    <img src="${currentQ.image}" class="puzzle-image" onclick="enlargeImage()" alt="è¬é¡Œåœ–ç‰‡">
                    <input type="text" class="answer-input" id="answer${level}" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ">
                    <button class="submit-btn" onclick="${checkFunction}()">æäº¤ç­”æ¡ˆ</button>
                    <div class="error-message" id="error${level}"></div>
                    <div class="success-message" id="success${level}"></div>
                `;
            }
            
            document.getElementById('levelContent').innerHTML = `
                <div class="level-header">
                    <div class="level-title">${content.title}</div>
                    <div class="level-status ${isCompleted || currentQuestion >= questions.length ? 'status-completed' : 'status-available'}">
                        ${isCompleted || currentQuestion >= questions.length ? 'å·²å®Œæˆ' : 'æ¢ç´¢ä¸­'}
                    </div>
                </div>
                <div class="story-section">
                    <div class="story-title">æ•…äº‹èƒŒæ™¯</div>
                    <p style="white-space: pre-line;">${content.story}</p>
                </div>
                <div class="puzzle-content">
                    ${puzzleHTML}
                </div>
            `;
        }

        // ç²å–ç•¶å‰å•é¡Œç·¨è™Ÿ
        function getCurrentQuestion(level) {
            switch(level) {
                case 1: return currentLevel1Question;
                case 2: return currentLevel2Question;
                case 3: return currentLevel3Question;
                case 4: return currentLevel4Question;
                case 5: return currentLevel5Question;
                default: return 0;
            }
        }

        // æª¢æŸ¥ç­”æ¡ˆï¼ˆé€šç”¨å‡½æ•¸ï¼‰
        function checkUniverseAnswer(level, questions) {
            const userAnswer = document.getElementById(`answer${level}`).value.trim();
            const currentQuestion = getCurrentQuestion(level);
            
            // æª¢æŸ¥æ˜¯å¦è¶…å‡ºé¡Œç›®ç¯„åœ
            if (currentQuestion >= questions.length) {
                console.error(`é—œå¡${level}ï¼šç•¶å‰é¡Œç›®ç·¨è™Ÿ${currentQuestion}è¶…å‡ºç¯„åœï¼Œç¸½é¡Œç›®æ•¸ï¼š${questions.length}`);
                // å¦‚æœè¶…å‡ºç¯„åœï¼Œç›´æ¥å®Œæˆé—œå¡
                completeLevel(level);
                return;
            }
            
            const correctAnswer = questions[currentQuestion].answer;
            const errorDiv = document.getElementById(`error${level}`);
            const successDiv = document.getElementById(`success${level}`);
            
            console.log(`é—œå¡${level}ï¼Œç¬¬${currentQuestion + 1}é¡Œï¼Œç”¨æˆ¶ç­”æ¡ˆï¼š${userAnswer}ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š${correctAnswer}`);
            
            if (userAnswer === '') {
                errorDiv.textContent = 'è«‹è¼¸å…¥ç­”æ¡ˆï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            if (userAnswer === correctAnswer) {
                successDiv.textContent = `ç­”å°äº†ï¼ç¬¬ ${currentQuestion + 1} é¡Œå®Œæˆï¼`;
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                
                // å…ˆæ¨é€²å•é¡Œ
                advanceQuestion(level);
                // ä¿å­˜é€²åº¦
                saveProgress();
                
                setTimeout(() => {
                    // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é¡Œç›®
                    const newCurrentQuestion = getCurrentQuestion(level);
                    if (newCurrentQuestion >= questions.length) {
                        console.log(`é—œå¡${level}æ‰€æœ‰é¡Œç›®å®Œæˆï¼Œæº–å‚™å®Œæˆé—œå¡`);
                        completeLevel(level);
                    } else {
                        console.log(`é—œå¡${level}é€²å…¥ç¬¬${newCurrentQuestion + 1}é¡Œ`);
                        // å¦‚æœé‚„æœ‰æ›´å¤šé¡Œç›®ï¼Œé‡æ–°é¡¯ç¤ºç•¶å‰é—œå¡
                        if (level === 1) {
                            showUniverseContent(1, universe1Questions, 'checkUniverse1Answer');
                        } else if (level === 2) {
                            showUniverseContent(2, universe2Questions, 'checkUniverse2Answer');
                        } else if (level === 3) {
                            showUniverseContent(3, universe3Questions, 'checkUniverse3Answer');
                        } else if (level === 4) {
                            showUniverseContent(4, universe4Questions, 'checkUniverse4Answer');
                        } else if (level === 5) {
                            showUniverseContent(5, universe5Questions, 'checkUniverse5Answer');
                        }
                    }
                }, 2000);
            } else {
                errorDiv.textContent = 'ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                setTimeout(() => errorDiv.style.display = 'none', 3000);
            }
        }

        // æ¨é€²å•é¡Œ
        function advanceQuestion(level) {
            switch(level) {
                case 1: currentLevel1Question++; break;
                case 2: currentLevel2Question++; break;
                case 3: currentLevel3Question++; break;
                case 4: currentLevel4Question++; break;
                case 5: currentLevel5Question++; break;
            }
        }

        // å„å®‡å®™çš„æª¢æŸ¥å‡½æ•¸
        function checkUniverse1Answer() { checkUniverseAnswer(1, universe1Questions); }
        function checkUniverse2Answer() { checkUniverseAnswer(2, universe2Questions); }
        function checkUniverse3Answer() { checkUniverseAnswer(3, universe3Questions); }
        function checkUniverse4Answer() { checkUniverseAnswer(4, universe4Questions); }
        function checkUniverse5Answer() { checkUniverseAnswer(5, universe5Questions); }

        // é¡¯ç¤ºä¸€èˆ¬é—œå¡ï¼ˆç¬¬å…­é—œçš„æ‹¼å­—éŠæˆ²ï¼‰
        function showGeneralLevel(level) {
            const content = levelContents[level];
            const isCompleted = completedLevels.has(level);
            
            if (level === 6) {
                // ç¬¬å…­é—œçš„ç‰¹æ®Šæ‹¼å­—éŠæˆ²
                let gameHTML = '';
                
                if (!isCompleted) {
                    gameHTML = `
                        <div class="puzzle-question">
                            <strong>å‰µé€ è€…çš„æ‹¼å­—æŒ‘æˆ°</strong><br>
                            å°‡ä¸‹æ–¹çš„å­—æ¯æ‹–æ‹½æˆ–é»æ“Šä¾†é‡æ–°æ’åˆ—ï¼Œæ‹¼å‡ºæ­£ç¢ºçš„è‹±æ–‡å–®å­—ï¼
                        </div>
                        <div id="wordPuzzleGame">
                            <div id="letterPool" style="display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; justify-content: center;">
                                <!-- å­—æ¯æ± æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <div id="answerArea" style="display: flex; gap: 5px; margin: 20px 0; justify-content: center; min-height: 60px; padding: 10px; border: 2px dashed #8b755d; border-radius: 8px; align-items: center;">
                                <!-- ç­”æ¡ˆå€åŸŸ -->
                            </div>
                            <div style="text-align: center; margin: 20px 0;">
                                <button class="submit-btn" onclick="checkWordPuzzle()" style="width: auto; padding: 10px 30px; margin-right: 10px;">æª¢æŸ¥ç­”æ¡ˆ</button>
                                <button class="back-btn" onclick="resetWordPuzzle()" style="padding: 10px 20px;">é‡æ–°æ’åˆ—</button>
                            </div>
                        </div>
                        <div class="error-message" id="error6"></div>
                        <div class="success-message" id="success6"></div>
                    `;
                } else {
                    gameHTML = `
                        <div class="puzzle-question">
                            <strong>ç¬¬å…­é—œå·²å®Œæˆï¼</strong><br>
                            ä½ æˆåŠŸæ‹¼å‡ºäº†ã€ŒCREATEã€ï¼çœŸæ­£çš„å‰µé€ è€…æ‡‚å¾—å°‡æ•£äº‚çš„å…ƒç´ é‡æ–°çµ„åˆæˆæœ‰æ„ç¾©çš„æ•´é«”ã€‚
                        </div>
                        <div style="text-align: center; margin: 20px 0; padding: 20px; background: rgba(46, 204, 113, 0.1); border-radius: 8px; border: 1px solid rgba(46, 204, 113, 0.2);">
                            <div style="font-size: 2em; font-weight: bold; color: #27ae60; margin-bottom: 10px;">CREATE</div>
                            <div style="color: #5a4a3a;">å‰µé€  - é€™å°±æ˜¯å¤šå…ƒå®‡å®™å­˜åœ¨çš„æ„ç¾©</div>
                        </div>
                        <button class="start-btn" onclick="backToGrid()" style="margin-top: 20px; width: 100%;">
                            ç¹¼çºŒæ¢ç´¢å…¶ä»–å¤šå…ƒå®‡å®™
                        </button>
                    `;
                }
                
                document.getElementById('levelContent').innerHTML = `
                    <div class="level-header">
                        <div class="level-title">${content.title}</div>
                        <div class="level-status ${isCompleted ? 'status-completed' : 'status-available'}">
                            ${isCompleted ? 'å·²å®Œæˆ' : 'æ¢ç´¢ä¸­'}
                        </div>
                    </div>
                    <div class="story-section">
                        <div class="story-title">æ•…äº‹èƒŒæ™¯</div>
                        <p style="white-space: pre-line;">${content.story}</p>
                    </div>
                    <div class="puzzle-content">
                        ${gameHTML}
                    </div>
                `;
                
                if (!isCompleted) {
                    initWordPuzzle();
                }
            }
        }

        // å®Œæˆé—œå¡
        function completeLevel(level) {
            completedLevels.add(level);
            
            // å¦‚æœæ˜¯å‰äº”é—œï¼Œæ‰è½å­—æ¯
            if (level >= 1 && level <= 5 && levelLetters[level]) {
                const letter = levelLetters[level];
                if (!collectedLetters.has(letter)) {
                    collectedLetters.add(letter);
                    setTimeout(() => {
                        showLetterDrop(letter);
                    }, 1500);
                }
            }
            
            const statusElement = document.querySelector(`#status${level}`);
            if (statusElement) {
                statusElement.textContent = 'å·²å®Œæˆ';
                statusElement.className = 'level-status status-completed';
                
                const cardElement = statusElement.closest('.level-card');
                if (cardElement) {
                    cardElement.classList.add('completed');
                }
            }
            
            updateProgress();
            updateCollectedLettersDisplay();
            checkLevel6Unlock();
            saveProgress();
            
            // ç‰¹åˆ¥è™•ç†ç¬¬å…­é—œå®Œæˆ
            if (level === 6) {
                console.log('ç¬¬å…­é—œå®Œæˆï¼Œæº–å‚™è·³è½‰æˆåŠŸé é¢');
                // ä¸éœ€è¦å»¶é²ï¼Œç›´æ¥è·³è½‰
                endGame(true);
            } else if (completedLevels.size === 6) {
                setTimeout(() => endGame(true), 1000);
            }
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            document.getElementById('progressText').textContent = `å·²å®Œæˆ ${completedLevels.size}/6 å€‹å®‡å®™`;
        }

        // è¿”å›é—œå¡é¸æ“‡
        function backToGrid() {
            document.getElementById('levelDetail').style.display = 'none';
            document.getElementById('levelsGrid').classList.remove('hidden');
        }

        // çµæŸéŠæˆ²
        function endGame(success) {
            console.log('endGameè¢«èª¿ç”¨ï¼Œsuccess:', success);
            clearInterval(gameTimer);
            
            if (success) {
                const totalTime = 40 * 60 - timeLeft;
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                
                console.log('æº–å‚™é¡¯ç¤ºæˆåŠŸé é¢ï¼Œç¸½æ™‚é–“:', totalTime, 'åˆ†é˜:', minutes, 'ç§’:', seconds);
                
                document.getElementById('finalTime').innerHTML = `
                    <div style="background: rgba(27, 174, 112, 0.1); padding: 20px; border-radius: 12px; border: 2px solid rgba(27, 174, 112, 0.3);">
                        <p style="font-size: 1.4em; color: #1bae70; margin-bottom: 10px;">ğŸ† ä»»å‹™å®Œæˆæ™‚é–“</p>
                        <p style="font-size: 2em; color: #8b755d; font-weight: bold;">ä½ ç¸½å…±ä½¿ç”¨äº† ${minutes} åˆ† ${seconds} ç§’å®Œæˆè§£è¬</p>
                    </div>
                `;
                
                const successPage = document.getElementById('successPage');
                console.log('æˆåŠŸé é¢å…ƒç´ :', successPage);
                
                if (successPage) {
                    successPage.style.display = 'flex';
                    console.log('æˆåŠŸé é¢å·²é¡¯ç¤º');
                } else {
                    console.error('æ‰¾ä¸åˆ°æˆåŠŸé é¢å…ƒç´ ï¼');
                }
            } else {
                alert('æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸã€‚');
                backToGrid();
            }
        }

        // åœ–ç‰‡æ”¾å¤§åŠŸèƒ½
        function enlargeImage() {
            const image = document.querySelector('.puzzle-image');
            const overlay = document.getElementById('overlay');
            
            if (image) {
                image.classList.add('enlarged');
                overlay.style.display = 'block';
            }
        }

        function closeEnlargedImage() {
            const image = document.querySelector('.puzzle-image');
            const overlay = document.getElementById('overlay');
            
            if (image) {
                image.classList.remove('enlarged');
                overlay.style.display = 'none';
            }
        }

        // Enteréµäº‹ä»¶
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.classList.contains('answer-input')) {
                    const level = parseInt(activeElement.id.replace('answer', ''));
                    
                    if (level === 1) checkUniverse1Answer();
                    else if (level === 2) checkUniverse2Answer();
                    else if (level === 3) checkUniverse3Answer();
                    else if (level === 4) checkUniverse4Answer();
                    else if (level === 5) checkUniverse5Answer();
                    else checkAnswer(level);
                }
            }
        });

        // é¡Œç›®å±•é–‹/æ”¶èµ·åŠŸèƒ½
        function toggleQuestionDetail(level, index) {
            const detailElement = document.getElementById(`detail${level}_${index}`);
            const toggleElement = document.getElementById(`toggle${level}_${index}`);
            
            if (detailElement.style.display === 'none') {
                detailElement.style.display = 'block';
                toggleElement.textContent = 'â–² æ”¶èµ·';
            } else {
                detailElement.style.display = 'none';
                toggleElement.textContent = 'â–¼ å±•é–‹';
            }
        }

        // ç¬¬å…­é—œæ‹¼å­—éŠæˆ²ç›¸é—œå‡½æ•¸
        let currentWord = [];
        let availableLetters = [];

        function initWordPuzzle() {
            const targetWord = 'CREATE';
            availableLetters = targetWord.split('').sort(() => Math.random() - 0.5); // éš¨æ©Ÿæ‰“äº‚
            currentWord = [];
            
            renderWordPuzzle();
        }

        function renderWordPuzzle() {
            const letterPool = document.getElementById('letterPool');
            const answerArea = document.getElementById('answerArea');
            
            // æ¸²æŸ“å¯ç”¨å­—æ¯
            letterPool.innerHTML = '';
            availableLetters.forEach((letter, index) => {
                const letterTile = document.createElement('div');
                letterTile.className = 'letter-tile';
                letterTile.textContent = letter;
                letterTile.onclick = () => selectLetter(index);
                letterPool.appendChild(letterTile);
            });
            
            // æ¸²æŸ“ç­”æ¡ˆå€åŸŸ
            answerArea.innerHTML = '';
            for (let i = 0; i < 6; i++) { // CREATE æœ‰6å€‹å­—æ¯
                const slot = document.createElement('div');
                slot.className = 'answer-slot';
                if (currentWord[i]) {
                    const letterTile = document.createElement('div');
                    letterTile.className = 'letter-tile placed';
                    letterTile.textContent = currentWord[i];
                    letterTile.onclick = () => removeLetter(i);
                    slot.appendChild(letterTile);
                    slot.classList.add('filled');
                }
                answerArea.appendChild(slot);
            }
        }

        function selectLetter(index) {
            if (currentWord.length < 6) {
                const letter = availableLetters[index];
                currentWord.push(letter);
                availableLetters.splice(index, 1);
                renderWordPuzzle();
            }
        }

        function removeLetter(index) {
            const letter = currentWord[index];
            availableLetters.push(letter);
            currentWord.splice(index, 1);
            renderWordPuzzle();
        }

        function checkWordPuzzle() {
            const userWord = currentWord.join('');
            const errorDiv = document.getElementById('error6');
            const successDiv = document.getElementById('success6');
            
            if (userWord.length !== 6) {
                errorDiv.textContent = 'è«‹å°‡æ‰€æœ‰å­—æ¯éƒ½æ”¾å…¥ç­”æ¡ˆå€åŸŸï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                setTimeout(() => errorDiv.style.display = 'none', 3000);
                return;
            }
            
            if (userWord === 'CREATE') {
                successDiv.textContent = 'æ­å–œï¼ä½ æˆåŠŸæ‹¼å‡ºäº†ã€ŒCREATEã€ï¼å®‡å®™å…­å®Œæˆï¼';
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                
                console.log('CREATEæ‹¼å­—æˆåŠŸï¼Œæº–å‚™å®Œæˆç¬¬å…­é—œ');
                
                setTimeout(() => {
                    console.log('é–‹å§‹å®Œæˆç¬¬å…­é—œæµç¨‹');
                    completeLevel(6);
                }, 2000);
            } else {
                errorDiv.textContent = 'å­—æ¯é †åºä¸æ­£ç¢ºï¼Œè«‹é‡æ–°æ’åˆ—ï¼';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                setTimeout(() => errorDiv.style.display = 'none', 3000);
            }
        }

        function resetWordPuzzle() {
            initWordPuzzle();
        }
    </script>
</body>
</html>
